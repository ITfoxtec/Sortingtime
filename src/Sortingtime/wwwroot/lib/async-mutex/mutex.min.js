var Mutex=function(){function t(){this._queue=[],this._pending=!1}return t.prototype.isLocked=function(){return this._pending},t.prototype.acquire=function(){var n=this,t=new Promise(function(t){return n._queue.push(t)});return this._pending||this._dispatchNext(),t},t.prototype.runExclusive=function(e){return this.acquire().then(function(n){var t;try{t=e()}catch(t){throw n(),t}return Promise.resolve(t).then(function(t){return n(),t},function(t){throw n(),t})})},t.prototype._dispatchNext=function(){0<this._queue.length?(this._pending=!0,this._queue.shift()(this._dispatchNext.bind(this))):this._pending=!1},t}();