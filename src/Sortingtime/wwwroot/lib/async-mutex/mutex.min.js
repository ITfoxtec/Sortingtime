var Mutex=function(){function n(){this._queue=[];this._pending=!1}return n.prototype.isLocked=function(){return this._pending},n.prototype.acquire=function(){var n=this,t=new Promise(function(t){return n._queue.push(t)});return this._pending||this._dispatchNext(),t},n.prototype.runExclusive=function(n){return this.acquire().then(function(t){var i;try{i=n()}catch(r){t();throw r;}return Promise.resolve(i).then(function(n){return t(),n},function(n){t();throw n;})})},n.prototype._dispatchNext=function(){this._queue.length>0?(this._pending=!0,this._queue.shift()(this._dispatchNext.bind(this))):this._pending=!1},n}();