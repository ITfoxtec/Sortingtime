!function(){"use strict";function e(e,t){var r=this;r.getClass=function(e){return"/"===e?"/"===t.path()?"active":"":t.path().substr(0,e.length)===e?"active":""},r.isCollapsed=!0,e.$on("$routeChangeSuccess",function(){r.isCollapsed=!0})}angular.module("app").controller("navController",e),e.$inject=["$scope","$location"]}(),function(){"use strict";function e(e){this.onUsersTabSelect=function(){e.$broadcast("configController.onUsersTabSelect",null)}}angular.module("app").controller("configController",e),e.$inject=["$rootScope"]}(),function(){"use strict";function e(o,e,t,r){var i,n,a=this;a.loading=!1,a.showPasswordDialogToggle=!1,a.disabledChangeParssword=!0,a.activeSaveFullName=function(e,t){i.saveFullName(a.currentUser.fullName,e,function(e){t(e)})},a.showPasswordDialog=function(){a.changePasswordForm.$setPristine(),a.currentUser.password="",a.showPasswordDialogToggle=!0},a.cancelPasswordDialog=function(){a.showPasswordDialogToggle=!1},a.savePassword=function(){a.changePasswordForm.password.$setDirty(),a.changePasswordForm.$valid&&i.savePassword(a.currentUser.password,function(e){a.showPasswordDialogToggle=!1},function(e){if(e&&e.data&&angular.isObject(e.data)){var t=!1;for(var r in e.data)-1!=r.toLowerCase().indexOf("password")&&(t=!0,a.changePasswordForm.password.setServerErrorValidity(!1,e.data[r]));if(t)return void(e.isHandled=!0)}o.error(e)})};i=t.currentUser.getService(),n=t.currentOrganization.getService(),a.loading=!0,a.currentUser=i.getUser(function(e){a.loading=!1}),a.currentOrganization=n.getOrganization(function(e){a.disabledChangeParssword=e.isDemo})}angular.module("app").controller("myController",e),e.$inject=["notificationFactory","restService","genericDataFactory","$window"]}(),function(){"use strict";function e(e,t,r,o){var i,n=this;n.loading=!1,n.cultures=[{label:"ORG.CULTURES.ENGLISH_USA",name:"en-US"},{label:"ORG.CULTURES.ENGLISH_UK",name:"en-GB"},{label:"ORG.CULTURES.DANISH",name:"da-DK"}],n.showLanguageDialogToggle=!1,n.activeSaveName=function(e,t){i.saveName(n.currentOrganization.name,e,function(e){t(e)})},n.activeSaveAddress=function(e,t){i.saveAddress(n.currentOrganization.address,e,function(e){t(e)})},n.activeSaveFirstInvoiceNumber=function(e,t){i.saveFirstInvoiceNumber(n.currentOrganization.firstInvoiceNumber,e,function(e){t(e)})},n.showCultureDialog=function(){n.showCultureDialogToggle=!0},n.cancelCultureDialog=function(){n.showCultureDialogToggle=!1},n.saveCulture=function(){n.currentOrganization.culture||(n.currentOrganization.culture="auto"),n.changeCultureForm.$valid&&i.saveCulture(n.currentOrganization.culture,function(e){n.showCultureDialogToggle=!1,o.location.reload()})};i=r.currentOrganization.getService(),n.loading=!0,n.currentOrganization=i.getOrganization(function(e){n.loading=!1})}angular.module("app").controller("orgController",e),e.$inject=["notificationFactory","restService","genericDataFactory","$window"]}(),function(){"use strict";function e(o,e,t,r,i){var n,a,c,s=this;s.loading=!1,s.showCreateUserDialogToggle=!1,s.disabledAddUser=!0,r.$on("configController.onUsersTabSelect",function(e,t){s.currentUser&&s.users||(l(),u())}),s.showCreateUserDialog=function(){s.createUserForm.$setPristine(),s.newUser&&(s.newUser.fullName="",s.newUser.email=""),s.showCreateUserDialogToggle=!0},s.cancelCreateUserDialog=function(){s.showCreateUserDialogToggle=!1},s.createUser=function(){s.createUserForm.fullName.$setDirty(),s.createUserForm.email.$setDirty(),s.createUserForm.$valid&&n.save(s.newUser,function(e){s.users.push(e),s.disabledAddUser=!(!s.currentOrganization.isDemo&&s.users.length<5),s.showCreateUserDialogToggle=!1},function(e){if(e&&e.data&&angular.isObject(e.data)){var t=!1;for(var r in e.data)-1!=r.toLowerCase().indexOf("fullName")?(t=!0,s.createUserForm.fullName.setServerErrorValidity(!1,e.data[r])):-1!=r.toLowerCase().indexOf("email")&&(t=!0,s.createUserForm.email.setServerErrorValidity(!1,e.data[r]));if(t)return void(e.isHandled=!0)}o.error(e)})};var l=function(){s.loading=!0,s.currentUser=a.getUser(function(e){s.loading=!1}),s.currentOrganization=c.getOrganization(function(e){})},u=function(){s.users=n.query(function(e){for(var t in e)s.currentUser.id==e[t].id&&(e[t].you=!0);s.disabledAddUser=!(!s.currentOrganization.isDemo&&e.length<5),s.loading=!1},function(e){o.error(e)})};a=t.currentUser.getService(),c=t.currentOrganization.getService(),n=e.getService("./api/user")}angular.module("app").controller("userController",e),e.$inject=["notificationFactory","restService","genericDataFactory","$scope","$window"]}(),function(){"use strict";function e(n,e,t,r,o,i){var a,c,s,l,u,d,p=this;p.loading=!1,p.emptySorting=!1,p.showGroupTaskTotals=!1,p.sortingTabAvtive=!0,p.showCreateInvoiceDialogToggle=!1,p.showDetailInvoiceDialogToggle=!1,p.dateCursor={},p.updateDateCursor=function(e,t){f(),e()},p.toggleSelectGroup=function(e,t){e.stopPropagation(),e.preventDefault();var r=t.group,o=!t.selected;t.selected=o;for(var i,n,a=p.sorting.groupTasks,c=0,s=a.length;c<s;c++)if((i=a[c]).group==r){i.selected=o;for(var l=0,u=(n=i.users).length;l<u;l++)p.toggleSelectUser(e,n[l],null,o)}},p.toggleSelectTask=function(e,t){null!=e&&(e.stopPropagation(),e.preventDefault());var r=t.group,o=t.task,i=!t.selected;t.selected=i;for(var n,a,c=p.sorting.groupTasks,s=0,l=c.length;s<l;s++)if((n=c[s]).group==r&&n.task==o){n.selected=i;for(var u=0,d=(a=n.users).length;u<d;u++)p.toggleSelectUser(e,a[u],null,i)}},p.toggleSelectUser=function(e,t,r,o){var i;if(null!=e&&(e.stopPropagation(),e.preventDefault()),i=void 0!==o?o:!t.selected,t.selected!=i&&(t.price&&(p.sorting.selectedTotalPrice=p.sorting.selectedTotalPrice+(i?t.price:-1*t.price)),p.sorting.selectedUsers=p.sorting.selectedUsers+(i?1:-1)),t.selected=i,r)if(i){for(var n=r.users,a=!0,c=0,s=n.length;c<s;c++)if(!n[c].selected){a=!1;break}r.selected=a}else r.selected=i},p.noSelectUser=function(e){null!=e&&(e.stopPropagation(),e.preventDefault())},p.activeSaveUserHourPrice=function(e,t,l){s.save({groupReferenceKey:l.groupTask.group,taskReferenceKey:l.groupTask.task,userId:l.user.id,hourPrice:l.user.hourPrice},function(e){var t=l.user.price?l.user.price:0;l.user.price=l.user.hourPrice*l.user.time/60;var r=l.user.price-t;if(l.groupTask.price=(l.groupTask.price?l.groupTask.price:0)+r,p.sorting.totalPrice=(p.sorting.totalPrice?p.sorting.totalPrice:0)+r,l.user.selected&&(p.sorting.selectedTotalPrice=(p.sorting.selectedTotalPrice?p.sorting.selectedTotalPrice:0)+r),l.user.hourPrice)for(var o,i,n=0,a=p.sorting.groupTasks.length;n<a;n++)for(var c=0,s=(o=p.sorting.groupTasks[n]).users.length;c<s;c++)(i=o.users[c]).id==l.user.id&&null==i.hourPrice&&(i.hourPrice=l.user.hourPrice,t=i.price,i.price=i.hourPrice*i.time/60,r=i.price-t,p.sorting.totalPrice=p.sorting.totalPrice+r,p.sorting.selectedTotalPrice=p.sorting.selectedTotalPrice+r)},function(e){if(e&&e.data&&angular.isObject(e.data)){var t=!1;for(var r in e.data)-1!=r.toLowerCase().indexOf("hourPrice")&&(t=!0,l.form.hourPrice.setServerErrorValidity(!1,e.data[r]));if(t)return void(e.isHandled=!0)}n.error(e)})},p.showCreateInvoiceDialog=function(){p.emptySorting||(p.createInvoiceForm.$setPristine(),p.createInvoiceTabAvtive=0,D(),p.invoiceDate=p.dateCursor.to,E(),w(),b(),p.showCreateInvoiceDialogToggle=!0)},p.cancelCreateInvoiceDialog=function(){p.showCreateInvoiceDialogToggle=!1},p.createInvoice=function(){if(p.createInvoiceForm.sendToEmail.$setDirty(),p.createInvoiceForm.emailSubject.$setDirty(),p.createInvoiceForm.emailBody.$setDirty(),p.createInvoiceForm.invoiceTitle.$setDirty(),p.createInvoiceForm.invoiceCustomer.$setDirty(),p.createInvoiceForm.invoicePaymentDetails.$setDirty(),p.createInvoiceForm.invoicePaymentTerms.$setDirty(),p.createInvoiceForm.invoiceDate.$setDirty(),p.createInvoiceForm.invoiceReference.$setDirty(),p.createInvoiceForm.invoiceText.$setDirty(),p.currentOrganization.tax&&(p.createInvoiceForm.invoiceTaxPercentage1.$setDirty(),p.createInvoiceForm.invoiceTaxPercentage2.$setDirty()),p.currentOrganization.vat&&(p.createInvoiceForm.invoiceVatNumber.$setDirty(),p.createInvoiceForm.invoiceVatPercentage1.$setDirty(),p.createInvoiceForm.invoiceVatPercentage2.$setDirty()),p.createInvoiceForm.$valid){var e=h(!0);a.save(e,function(e){I(),y(),p.invoiceItems.push(e),p.invoiceItems.subTotalPrice+=e.subTotalPrice,p.showCreateInvoiceDialogToggle=!1},function(e){if(e&&e.data&&angular.isObject(e.data)){var t=!1,r=!1,o=!1;for(var i in e.data)-1!=i.toLowerCase().indexOf("toemail")?(r=t=!0,p.createInvoiceForm.sendToEmail.setServerErrorValidity(!1,e.data[i])):-1!=i.toLowerCase().indexOf("emailsubject")?(r=t=!0,p.createInvoiceForm.emailSubject.setServerErrorValidity(!1,e.data[i])):-1!=i.toLowerCase().indexOf("emailbody")?(r=t=!0,p.createInvoiceForm.emailBody.setServerErrorValidity(!1,e.data[i])):-1!=i.toLowerCase().indexOf("invoicetitle")?(o=t=!0,p.createInvoiceForm.invoiceTitle.setServerErrorValidity(!1,e.data[i])):-1!=i.toLowerCase().indexOf("invoicecustomer")?(o=t=!0,p.createInvoiceForm.invoiceCustomer.setServerErrorValidity(!1,e.data[i])):-1!=i.toLowerCase().indexOf("vatnumber")?(o=t=!0,p.createInvoiceForm.invoiceVatNumber.setServerErrorValidity(!1,e.data[i])):-1!=i.toLowerCase().indexOf("paymentdetails")?(o=t=!0,p.createInvoiceForm.invoicePaymentDetails.setServerErrorValidity(!1,e.data[i])):-1!=i.toLowerCase().indexOf("invoiceraymentterms")?(o=t=!0,p.createInvoiceForm.invoicePaymentTerms.setServerErrorValidity(!1,e.data[i])):-1!=i.toLowerCase().indexOf("invoicedate")?(t=!0,createInvoiceTabAvtive=1,p.createInvoiceForm.invoiceDate.setServerErrorValidity(!1,e.data[i])):-1!=i.toLowerCase().indexOf("invoicereference")?(o=t=!0,p.createInvoiceForm.invoiceReference.setServerErrorValidity(!1,e.data[i])):-1!=i.toLowerCase().indexOf("invoicetext")?(o=t=!0,p.createInvoiceForm.invoiceText.setServerErrorValidity(!1,e.data[i])):-1!=i.toLowerCase().indexOf("taxpercentage")?(o=t=!0,p.createInvoiceForm.invoiceTaxPercentage1.setServerErrorValidity(!1,e.data[i]),p.createInvoiceForm.invoiceTaxPercentage2.setServerErrorValidity(!1,e.data[i])):-1!=i.toLowerCase().indexOf("vatpercentage")&&(o=t=!0,p.createInvoiceForm.invoiceVatPercentage1.setServerErrorValidity(!1,e.data[i]),p.createInvoiceForm.invoiceVatPercentage2.setServerErrorValidity(!1,e.data[i]));if(t)return e.isHandled=!0,void(r?p.createInvoiceTabAvtive=0:o&&(p.createInvoiceTabAvtive=1))}n.error(e)})}else p.createInvoiceForm.sendToEmail.$invalid||p.createInvoiceForm.emailSubject.$invalid||p.createInvoiceForm.emailBody.$invalid?p.createInvoiceTabAvtive=0:p.currentOrganization.tax&&(p.createInvoiceForm.invoiceTaxPercentage1.$invalid||p.createInvoiceForm.invoiceTaxPercentage2.$invalid)||p.currentOrganization.vat&&(p.createInvoiceForm.invoiceVatPercentage1.$invalid||p.createInvoiceForm.invoiceVatPercentage2.$invalid)||p.createInvoiceForm.invoiceDate.$invalid?p.createInvoiceTabAvtive=1:p.createInvoiceTabAvtive=0},p.activeSaveOrganizationName=function(e,t){d.saveName(p.currentOrganization.name,e,function(e){t(e)})},p.activeSaveOrganizationAddress=function(e,t){d.saveAddress(p.currentOrganization.address,e,function(e){t(e)})},p.activeSaveOrganizationVatNumber=function(e,t){d.saveVatNumber(p.currentOrganization.vatNumber,e,function(e){t(e)})},p.activeSaveOrganizationPaymentDetails=function(e,t){d.savePaymentDetails(p.currentOrganization.paymentDetails,e,function(e){t(e)})},p.activeSaveOrganizationTaxPercentage=function(t,r){d.saveTaxPercentage(p.currentOrganization.taxPercentage,function(e){S(!0,!1),t(e)},function(e){r(e)})},p.activeSaveOrganizationVatPercentage=function(t,r){d.saveVatPercentage(p.currentOrganization.vatPercentage,function(e){S(!1,!0),t(e)},function(e){r(e)})},p.createInvoicePriceUpdate=function(e,t,r){if(t.$valid){var o=r.price?r.price:0;r.price=r.time/60*r.hourPrice;var i=r.price-o;p.sorting.selected.subTotalPrice=p.sorting.selected.subTotalPrice+i,S(!0,!0)}},p.showInvoiceItemMenu=function(e,t,r){e.preventDefault(),e.stopPropagation(),p.invoiceItemSelected&&(p.invoiceItemSelected.selected=!1,p.invoiceItemSelected.selectedPopup=!1),r.selected=!0,r.index=t,p.invoiceItemSelected=r,$(e.target).append($("#invoiceItemMenu")),p.invoiceItemMenuIsOpen=!0};var m=function(){p.invoiceItemMenuIsOpen=!1,$("#invoiceItemMenuContainder").append($("#invoiceItemMenu"))};p.showDetailInvoiceItem=function(e){e.preventDefault(),e.stopPropagation(),p.invoiceItemSelected.selectedPopup=!0,m(),p.detailInvoiceForm.$setPristine(),p.invoiceId=p.invoiceItemSelected.id,c.get({id:p.invoiceItemSelected.id},function(e){p.invoiceNumber=e.number,p.invoiceSubTotalPrice=e.subTotalPrice,p.invoiceSentToEmail=e.toEmail,p.invoiceEmailSubject=e.emailSubject,p.invoiceEmailBody=e.emailBody,p.showDetailInvoiceDialogToggle=!0,p.loading=!1},function(e){n.error(e)})},p.cancelDetailInvoiceDialog=function(){p.invoiceItemSelected.selectedPopup=!1,p.showDetailInvoiceDialogToggle=!1},p.resendDetailInvoice=function(){if(p.detailInvoiceForm.sendToEmail.$setDirty(),p.detailInvoiceForm.emailSubject.$setDirty(),p.detailInvoiceForm.emailBody.$setDirty(),p.detailInvoiceForm.$valid){var e=h(!1);e.relatedId=p.invoiceId,e.invoice={subTotalPrice:p.invoiceSubTotalPrice},a.save(e,function(e){p.invoiceItemSelected.status=600,p.invoiceItemSelected.toEmail=e.toEmail,p.invoiceItemSelected.selectedPopup=!1,p.showDetailInvoiceDialogToggle=!1},function(e){if(e&&e.data&&angular.isObject(e.data)){var t=!1;for(var r in e.data)-1!=r.toLowerCase().indexOf("toemail")?(t=!0,p.detailInvoiceForm.sendToEmail.setServerErrorValidity(!1,e.data[r])):-1!=r.toLowerCase().indexOf("emailsubject")?(t=!0,p.detailInvoiceForm.emailSubject.setServerErrorValidity(!1,e.data[r])):-1!=r.toLowerCase().indexOf("emailbody")&&(t=!0,p.detailInvoiceForm.emailBody.setServerErrorValidity(!1,e.data[r]));if(t)return void(e.isHandled=!0)}n.error(e)})}},p.showCreateCreditNotaDialog=function(e){e.preventDefault(),e.stopPropagation(),p.invoiceItemSelected.selectedPopup=!0,m(),o("GENERAL.COMING_SOON").then(function(e){n.warning(e)}),p.invoiceItemSelected.selectedPopup=!1},p.showDeleteInvoiceDialog=function(e){e.preventDefault(),e.stopPropagation(),p.invoiceItemSelected.selectedPopup=!0,m(),p.invoiceNumber=p.invoiceItemSelected.number,p.showDeleteInvoiceDialogToggle=!0},p.sendDeleteInvoice=function(e){c.delete({id:p.invoiceItemSelected.id},function(e){p.invoiceItems.subTotalPrice-=p.invoiceItemSelected.subTotalPrice,p.invoiceItems.splice(p.invoiceItemSelected.index,1),p.invoiceItemSelected.selectedPopup=!1,p.showDeleteInvoiceDialogToggle=!1},function(e){n.error(e)})},p.cancelDeleteInvoiceDialog=function(e){p.invoiceItemSelected.selectedPopup=!1,p.showDeleteInvoiceDialogToggle=!1};var g,f=function(){p.emptyReport=!0,p.sorting=null,setTimeout(function(){v()},0),setTimeout(function(){T()},0)},v=function(){p.loading=!0,a.get({fromDate:p.dateCursor.from.toServerDateString(),toDate:p.dateCursor.to.toServerDateString()},function(e){p.sorting=e,p.sorting.selectedTotalPrice=0,p.sorting.selectedUsers=0,p.emptySorting=!p.sorting.groupTasks||!p.sorting.groupTasks.length,p.loading=!1},function(e){n.error(e)})},T=function(){p.loading=!0,c.query({fromDate:p.dateCursor.from.toServerDateString(),toDate:p.dateCursor.to.toServerDateString()},function(e){p.invoiceItems=e;for(var t=0,r=p.invoiceItems,o=0,i=r.length;o<i;o++)t+=r[o].subTotalPrice;p.invoiceItems.subTotalPrice=t,p.loading=!1},function(e){n.error(e)})},h=function(e){var t={toEmail:p.invoiceSentToEmail,emailSubject:p.invoiceEmailSubject,emailBody:p.invoiceEmailBody};if(e){t.showGroupColl=p.showGroupCollInvoiceDialog,t.invoiceTitle=p.invoiceTitle,t.invoiceCustomer=p.invoiceCustomer,t.paymentDetails=p.currentOrganization.paymentDetails,t.invoicePaymentTerms=p.invoicePaymentTerms,t.invoiceDate=p.invoiceDate.toServerDateString(),t.invoiceReference=p.invoiceReference,t.invoiceText=p.invoiceText,t.tax=p.currentOrganization.tax,t.vat=p.currentOrganization.vat,p.currentOrganization.tax&&(t.taxPercentage=p.currentOrganization.taxPercentage,t.taxPrice=p.sorting.selected.taxPrice),p.currentOrganization.vat&&(t.vatNumber=p.currentOrganization.vatNumber,t.vatPercentage=p.currentOrganization.vatPercentage,t.vatPrice=p.sorting.selected.vatPrice),t.totalPrice=p.sorting.selected.totalPrice,t.invoice={subTotalPrice:p.sorting.selected.subTotalPrice,groupTasks:[]};for(var r,o,i,n=p.sorting.selected.groupTasks,a=t.invoice.groupTasks,c=0,s=n.length;c<s;c++){(r=$.extend(!1,{},n[c])).users=[],r.usersSelected=void 0,r.selected=void 0,a.push(r);for(var l=0,u=(i=n[c].usersSelected).length;l<u;l++)(o=$.extend(!1,{},i[l])).selected=void 0,r.users.push(o)}}return t},D=function(){p.sorting.selectedUsers||p.sorting.groupTasks&&0<p.sorting.groupTasks.length&&p.toggleSelectTask(null,p.sorting.groupTasks[0])},y=function(){for(var e,t,r=p.sorting.groupTasks,o=0,i=r.length;o<i;o++){(e=r[o]).selected=!1;for(var n=0,a=(t=e.users).length;n<a;n++)t[n].selected=!1}p.sorting.selectedTotalPrice=0,p.sorting.selectedUsers=0},S=function(e,t){var r=p.sorting.selected;if(r){if(e)if(p.currentOrganization.tax){var o=(p.currentOrganization.taxPercentage?p.currentOrganization.taxPercentage:0)/100;r.taxPrice=(r.subTotalPrice?r.subTotalPrice:0)*o}else r.taxPrice=0;if(t)if(p.currentOrganization.vat){var i=(p.currentOrganization.vatPercentage?p.currentOrganization.vatPercentage:0)/100;r.vatPrice=(r.subTotalPrice?r.subTotalPrice:0)*i}else r.vatPrice=0;r.totalPrice=(r.subTotalPrice?r.subTotalPrice:0)+r.taxPrice+r.vatPrice}},b=function(){p.sorting.selected={groupTasks:[]};for(var e,t,r,o,i=0,n=p.sorting.selected.groupTasks,a=p.sorting.groupTasks,c=[],s=0,l=a.length;s<l;s++){c=[];for(var u=0,d=(o=(e=a[s]).users).length;u<d;u++)(r=o[u]).selected&&(c.push($.extend(!1,{},r)),i+=r.price?r.price:0);0<c.length&&((t=$.extend(!1,{},e)).usersSelected=c,n.push(t))}p.sorting.selected.subTotalPrice=i,S(!0,!0)},E=function(){p.showGroupCollInvoiceDialog=!1,p.firstTask=null,p.firstSelectedGroup=null,p.firstSelectedTask=null;for(var e,t=!1,r=p.sorting.groupTasks,o=0,i=r.length;o<i;o++){var n=r[o];if(p.firstTask||(p.firstTask=n.task),n.selected)if(!p.firstSelectedGroup&&n.group&&(p.firstSelectedGroup=n.group),p.firstSelectedTask||n.group||(p.firstSelectedTask=n.task),t){if(n.group!=e){p.showGroupCollInvoiceDialog=!0;break}}else t=!0,e=n.group}p.firstSelectedGroup||p.firstSelectedTask||(p.firstSelectedTask=p.firstTask)},I=function(){var e=p.firstSelectedGroup?"group":"task",t=p.firstSelectedGroup?p.firstSelectedGroup:p.firstSelectedTask;l.save({referenceType:e,referenceKey:t,toEmail:p.invoiceSentToEmail,emailSubject:p.invoiceEmailSubject,emailBody:p.invoiceEmailBody,invoiceTitle:p.invoiceTitle,invoiceCustomer:p.invoiceCustomer,invoicePaymentTerms:p.invoicePaymentTerms,invoiceReference:p.invoiceReference,invoiceText:p.invoiceText},function(e){},function(e){n.error(e)})},w=function(){var e=p.firstSelectedGroup?"group":"task",t=p.firstSelectedGroup?p.firstSelectedGroup:p.firstSelectedTask;l.get({referenceType:e,referenceKey:t},function(e){k(e)},function(e){n.error(e)})},k=function(e){p.invoiceSentToEmail=e.toEmail,p.invoiceEmailSubject=e.emailSubject,p.invoiceEmailBody=e.emailBody,p.invoiceTitle=e.invoiceTitle,p.invoiceCustomer=e.invoiceCustomer,p.invoicePaymentTerms=e.invoicePaymentTerms,p.invoiceReference=e.invoiceReference,p.invoiceText=e.invoiceText,p.invoiceEmailSubject||o("INVOICE.EMAIL_SUBJECT_DFAULTTEXT").then(function(e){p.invoiceEmailSubject=e}),p.invoiceEmailBody||o("INVOICE.EMAIL_BODY_DFAULTTEXT").then(function(e){p.invoiceEmailBody=e}),p.invoiceTitle||o("INVOICE.INVOICE_TITLE_DFAULTTEXT").then(function(e){p.invoiceTitle=e}),p.invoicePaymentTerms||o("INVOICE.PAYMENT_TERMS_DFAULTTEXT").then(function(e){p.invoicePaymentTerms=e}),S(!0,!0)};g=(new Date).toDateOnlyFirstDayInMonth(),p.dateCursor={from:g,to:g.toDateOnlyLastDayInMonth()},a=e.getService("./api/invoicing"),c=e.getService("./api/invoiceItem"),s=e.getService("./api/HourPriceSetting"),l=e.getService("./api/invoiceSetting"),u=t.currentUser.getService(),d=t.currentOrganization.getService(),p.currentUser=u.getUser(),p.currentOrganization=d.getOrganization(function(e){1<p.currentOrganization.userCount&&(p.showGroupTaskTotals=!0)}),f()}angular.module("app").controller("invoicingController",e),e.$inject=["notificationFactory","restService","genericDataFactory","$filter","$translate","$scope"]}(),function(){"use strict";function e(o,e,t,a,r,i){var n,c,s,l,u,d=this;d.loading=!1,d.emptyReport=!1,d.reportTabAvtive=!0,d.showCreateReportDialogToggle=!1,d.showDetailReportDialogToggle=!1,d.dateCursor={},d.updateDateCursor=function(e,t){f(),e()},d.toggleSelectUser=function(e,t){e.stopPropagation(),e.preventDefault(),t.selected=!t.selected;for(var r=t.groupTasks,o=0,i=r.length;o<i;o++)d.toggleSelectTask(e,r[o],t.selected)},d.toggleSelectTotalGroup=function(e,t){e.stopPropagation(),e.preventDefault();var r,o=t.group;t.selected=!t.selected;for(var i=0,n=d.reportsFlattened.length;i<n;i++)"groupTask"==(r=d.reportsFlattened[i]).type&&r.group==o&&(r.selected=t.selected);for(i=0,n=d.report.groupTaskTotals.length;i<n;i++)(r=d.report.groupTaskTotals[i]).group==o&&(r.selected=t.selected)},d.toggleSelectTotalTask=function(e,t){null!=e&&(e.stopPropagation(),e.preventDefault());var r,o=t.group,i=t.task;t.selected=!t.selected;for(var n=0,a=d.reportsFlattened.length;n<a;n++)"groupTask"==(r=d.reportsFlattened[n]).type&&r.group==o&&r.task==i&&(r.selected=t.selected)},d.toggleSelectGroup=function(e,t){e.stopPropagation(),e.preventDefault();var r=!t.selected;t.selected=r,p(t);for(var o,i=t.group,n=0,a=t.user.groupTasks.length;n<a;n++)"groupTask"==(o=t.user.groupTasks[n]).type&&o.group==i&&o.selected!=r&&(o.selected=r,p(o))},d.toggleSelectTask=function(e,t,r){e.stopPropagation(),e.preventDefault(),t.selected=void 0!==r?r:!t.selected,p(t)};var p=function(e){var t,r=e.group,o=e.task,i=e.selected,n=!0;if(i)for(var a=0,c=d.reportsFlattened.length;a<c;a++)if("groupTask"==(t=d.reportsFlattened[a]).type&&t.group==r&&t.task==o&&t.selected!=i){n=!1;break}if(n)for(a=0,c=d.report.groupTaskTotals.length;a<c;a++)(t=d.report.groupTaskTotals[a]).group==r&&t.task==o&&(t.selected=i)};d.showCreateReportDialog=function(){d.emptyReport||null==d.reportsFlattened||0==d.reportsFlattened.length||(d.createReportForm.$setPristine(),d.CreateReportTabAvtive=0,I(),k(),S(),F(),O(),d.showCreateReportDialogToggle=!0)},d.cancelCreateReportDialog=function(){d.showCreateReportDialogToggle=!1},d.createReport=function(){if(d.createReportForm.sendToEmail.$setDirty(),d.createReportForm.emailSubject.$setDirty(),d.createReportForm.emailBody.$setDirty(),d.createReportForm.reportTitle.$setDirty(),d.createReportForm.reportSubTitle.$setDirty(),d.createReportForm.reportText.$setDirty(),d.createReportForm.$valid){var e=h(!0);n.save(e,function(e){C(),w(),d.reportItems.push(e),d.reportItems.totalTime+=e.totalTime,d.showCreateReportDialogToggle=!1},function(e){if(e&&e.data&&angular.isObject(e.data)){var t=!1;for(var r in e.data)-1!=r.toLowerCase().indexOf("toemail")?(t=!0,d.createReportForm.sendToEmail.setServerErrorValidity(!1,e.data[r])):-1!=r.toLowerCase().indexOf("emailsubject")?(t=!0,d.createReportForm.emailSubject.setServerErrorValidity(!1,e.data[r])):-1!=r.toLowerCase().indexOf("emailbody")?(t=!0,d.createReportForm.emailBody.setServerErrorValidity(!1,e.data[r])):-1!=r.toLowerCase().indexOf("reporttitle")?(t=!0,d.createReportForm.reportTitle.setServerErrorValidity(!1,e.data[r])):-1!=r.toLowerCase().indexOf("reportsubtitle")?(t=!0,d.createReportForm.reportSubTitle.setServerErrorValidity(!1,e.data[r])):-1!=r.toLowerCase().indexOf("reporttext")&&(t=!0,d.createReportForm.reportText.setServerErrorValidity(!1,e.data[r]));if(t)return void(e.isHandled=!0)}o.error(e)})}else d.CreateReportTabAvtive=0},d.activeSaveOrganizationName=function(e,t){u.saveName(d.currentOrganization.name,e,function(e){t(e)})},d.activeSaveOrganizationAddress=function(e,t){u.saveAddress(d.currentOrganization.address,e,function(e){t(e)})},d.showReportItemMenu=function(e,t,r){e.preventDefault(),e.stopPropagation(),d.reportItemSelected&&(d.reportItemSelected.selected=!1,d.reportItemSelected.selectedPopup=!1),r.selected=!0,r.index=t,d.reportItemSelected=r,$(e.target).append($("#reportItemMenu")),d.reportItemMenuIsOpen=!0};var m=function(){d.reportItemMenuIsOpen=!1,$("#reportItemMenuContainder").append($("#reportItemMenu"))};d.showDetailReportItem=function(e){e.preventDefault(),e.stopPropagation(),d.detailReportForm.$setPristine(),F(),d.reportItemSelected.selectedPopup=!0,m(),d.reportId=d.reportItemSelected.id,c.get({id:d.reportItemSelected.id},function(e){d.reportNumber=e.number,d.reportTotalTime=e.totalTime,d.reportSentToEmail=e.toEmail,d.reportEmailSubject=e.emailSubject,d.reportEmailBody=e.emailBody,d.showDetailReportDialogToggle=!0,d.loading=!1},function(e){o.error(e)})},d.cancelDetailReportDialog=function(){d.reportItemSelected.selectedPopup=!1,d.showDetailReportDialogToggle=!1},d.resendDetailReport=function(){if(d.detailReportForm.sendToEmail.$setDirty(),d.detailReportForm.emailSubject.$setDirty(),d.detailReportForm.emailBody.$setDirty(),d.detailReportForm.$valid){var e=h(!1);e.relatedId=d.reportId,e.report={monthTotal:d.reportTotalTime},n.save(e,function(e){d.reportItemSelected.status=600,d.reportItemSelected.toEmail=e.toEmail,d.reportItemSelected.selectedPopup=!1,d.showDetailReportDialogToggle=!1},function(e){if(e&&e.data&&angular.isObject(e.data)){var t=!1;for(var r in e.data)-1!=r.toLowerCase().indexOf("toemail")?(t=!0,d.detailReportForm.sendToEmail.setServerErrorValidity(!1,e.data[r])):-1!=r.toLowerCase().indexOf("emailsubject")?(t=!0,d.detailReportForm.emailSubject.setServerErrorValidity(!1,e.data[r])):-1!=r.toLowerCase().indexOf("emailbody")&&(t=!0,d.detailReportForm.emailBody.setServerErrorValidity(!1,e.data[r]));if(t)return void(e.isHandled=!0)}o.error(e)})}},d.showDeleteReportDialog=function(e){e.preventDefault(),e.stopPropagation(),d.reportItemSelected.selectedPopup=!0,m(),d.reportNumber=d.reportItemSelected.number,d.showDeleteReportDialogToggle=!0},d.sendDeleteReport=function(e){c.delete({id:d.reportItemSelected.id},function(e){d.reportItems.totalTime-=d.reportItemSelected.totalTime,d.reportItems.splice(d.reportItemSelected.index,1),d.reportItemSelected.selectedPopup=!1,d.showDeleteReportDialogToggle=!1},function(e){o.error(e)})},d.cancelDeleteReportDialog=function(e){d.reportItemSelected.selectedPopup=!1,d.showDeleteReportDialogToggle=!1};var g,f=function(){setTimeout(function(){v()},0),setTimeout(function(){T()},0)},v=function(){d.loading=!0,n.get({fromDate:d.dateCursor.from.toServerDateString(),toDate:d.dateCursor.to.toServerDateString()},function(e){d.report=e,D(),d.daysInMonth=d.report.daysInMonth,d.loading=!1},function(e){o.error(e)})},T=function(){d.loading=!0,c.query({fromDate:d.dateCursor.from.toServerDateString(),toDate:d.dateCursor.to.toServerDateString()},function(e){d.reportItems=e;for(var t=0,r=d.reportItems,o=0,i=r.length;o<i;o++)t+=r[o].totalTime;d.reportItems.totalTime=t,d.loading=!1},function(e){o.error(e)})},h=function(e){var t={toEmail:d.reportSentToEmail,emailSubject:d.reportEmailSubject,emailBody:d.reportEmailBody};if(e){var r,o,i;t.showGroupColl=d.showGroupCollRaportDialog,t.reportTitle=d.reportTitle,t.reportSubTitle=d.reportSubTitle,t.reportText=d.reportText,t.report=$.extend(!1,{},d.report),t.report.monthTotal=d.monthTotalSelected,t.report.groupTaskTotals=[];for(var n=0,a=d.groupTaskTotalsSelected.length;n<a;n++)r=d.groupTaskTotalsSelected[n],t.report.groupTaskTotals.push($.extend(!1,{},r));t.report.users=[];for(n=0,a=d.reportsFlattenedSelected.length;n<a;n++)"user"==(r=d.reportsFlattenedSelected[n]).type?((o=$.extend(!1,{},r)).groupTasks=[],o.type=void 0,o.selected=void 0,t.report.users.push(o)):"groupTask"==r.type&&((i=$.extend(!1,{},r)).user=void 0,i.type=void 0,i.allWorks=void 0,i.selected=void 0,i.selectNext=void 0,o.groupTasks.push(i))}return t},D=function(){for(var e,t,r,o=!0,i=[],n=0,a=d.report.users.length;n<a;n++){e=d.report.users[n],r&&i.push({type:"space",user:r}),o=!1,(r=e).type="user",i.push(e),i.push({type:"groupTaskHead",user:e});for(var c=0,s=e.groupTasks.length;c<s;c++)(t=e.groupTasks[c]).type="groupTask",t.user=e,i.push(t),t.allWorks=y(t)}d.emptyReport=o,d.reportsFlattened=i},y=function(e){for(var t,r,o=0,i=[],n=1;n<=d.report.daysInMonth;n++)r=null,(t=e.works[o])&&t.day==n&&((r=t).timeView=a("time")(r.time),o++),r||(r={day:n}),i.push(r);return i},S=function(){var e,t;d.reportsFlattenedSelected=[];for(var r=0,o=d.reportsFlattened.length;r<o;r++)(e=d.reportsFlattened[r]).selected?d.reportsFlattenedSelected.push(e):e.selected||"user"!=e.type?"groupTaskHead"!=e.type&&"space"!=e.type||!b(e.user)||d.reportsFlattenedSelected.push(e):b(e)&&(t=$.extend(!1,{},e),E(e,t),d.reportsFlattenedSelected.push(t));d.monthTotalSelected=0,d.groupTaskTotalsSelected=[];for(r=0,o=d.reportsFlattenedSelected.length;r<o;r++)if("groupTask"==(e=d.reportsFlattenedSelected[r]).type){for(var i=null,n=0,a=d.groupTaskTotalsSelected.length;n<a;n++){var c=d.groupTaskTotalsSelected[n];if(c.group==e.group&&c.task==e.task){i=c;break}}i||(i={group:e.group,task:e.task,monthTotal:0},d.groupTaskTotalsSelected.push(i)),i.monthTotal+=e.monthTotal,d.monthTotalSelected+=e.monthTotal}},b=function(e){if(e.selected)return!0;for(var t=e.groupTasks,r=0,o=t.length;r<o;r++){if(t[r].selected)return!0}return!1},E=function(e,t){for(var r=0,o=0,i=e.groupTasks,n=0,a=i.length;n<a;n++){var c=i[n];c.selected&&(r+=c.monthTotal,o++)}t.monthTotal=r,t.selectedCount=o},I=function(){for(var e=!1,t=0,r=d.reportsFlattened.length;t<r;t++)d.reportsFlattened[t].selected&&(e=!0);e||d.report.groupTaskTotals&&0<d.report.groupTaskTotals.length&&d.toggleSelectTotalTask(null,d.report.groupTaskTotals[0])},w=function(){for(var e=d.report.groupTaskTotals,t=d.reportsFlattened,r=0,o=e.length;r<o;r++)e[r].selected=!1;for(r=0,o=t.length;r<o;r++){var i;(i=t[r]).selected&&(i.selected=!1)}},k=function(){d.firstSelectedGroup=null,d.firstSelectedTask=null;for(var e,t=!1,r=0,o=d.reportsFlattened.length;r<o;r++){var i=d.reportsFlattened[r];if("groupTask"==i.type&&i.selected)if(!d.firstSelectedGroup&&i.group&&(d.firstSelectedGroup=i.group),d.firstSelectedTask||i.group||(d.firstSelectedTask=i.task),t){if(i.group!=e)return void(d.showGroupCollRaportDialog=!0)}else t=!0,e=i.group}d.showGroupCollRaportDialog=!1},C=function(){var e=d.firstSelectedGroup?"group":"task",t=d.firstSelectedGroup?d.firstSelectedGroup:d.firstSelectedTask;s.save({referenceType:e,referenceKey:t,toEmail:d.reportSentToEmail,emailSubject:d.reportEmailSubject,emailBody:d.reportEmailBody,reportTitle:d.reportTitle,reportText:d.reportText},function(e){},function(e){o.error(e)})},O=function(){var e=d.firstSelectedGroup?"group":"task",t=d.firstSelectedGroup?d.firstSelectedGroup:d.firstSelectedTask;s.get({referenceType:e,referenceKey:t},function(e){P(e)},function(e){o.error(e)})},P=function(e){d.reportSentToEmail=e.toEmail,d.reportEmailSubject=e.emailSubject,d.reportEmailBody=e.emailBody,d.reportTitle=e.reportTitle,d.reportText=e.reportText,d.reportEmailSubject||r("REPORT.EMAIL_SUBJECT_DFAULTTEXT").then(function(e){d.reportEmailSubject=e}),d.reportEmailBody||r("REPORT.EMAIL_BODY_DFAULTTEXT").then(function(e){d.reportEmailBody=e}),d.reportTitle||r("REPORT.REPORT_TITLE_DFAULTTEXT").then(function(e){d.reportTitle=e}),r("REPORT.REPORT_TITLE_SUB_DFAULTTEXT").then(function(e){d.reportSubTitle=e.replace("<begin_time>",a("date")(d.dateCursor.from,"mediumDate")).replace("<end_time>",a("date")(d.dateCursor.to,"mediumDate"))})},F=function(){d.currentUser=l.getUser(),d.currentOrganization=u.getOrganization()};g=(new Date).toDateOnlyFirstDayInMonth(),d.dateCursor={from:g,to:g.toDateOnlyLastDayInMonth()},n=e.getService("./api/reporting"),c=e.getService("./api/reportItem"),s=e.getService("./api/reportSetting"),l=t.currentUser.getService(),u=t.currentOrganization.getService(),f()}angular.module("app").controller("reportingController",e),e.$inject=["notificationFactory","restService","genericDataFactory","$filter","$translate","$scope"]}(),function(){"use strict";function e(n,e,t,r){var o,a,c,s,l,i,u,d=this,p=1;d.loading=!1,d.dayTotal=0,d.weekTotal=0,d.monthTotal=0,d.showTimerDialogToggle=!1,d.timerData=null,d.pageItems=[],d.currentGroupIds,d.currentTaskIds=[],d.changedUniqIds=[],d.brakes=[{label:"TIME.BRAKE_00MIN",time:0},{label:"TIME.BRAKE_05MIN",time:5},{label:"TIME.BRAKE_10MIN",time:10},{label:"TIME.BRAKE_15MIN",time:15},{label:"TIME.BRAKE_30MIN",time:30},{label:"TIME.BRAKE_45MIN",time:45},{label:"TIME.BRAKE_60MIN",time:60}],d.dateCursor=(new Date).toDateOnly(),d.updateDateCursor=function(e,t){g(),e()},d.getGroups=function(e,t,r){i.query({filter:e,eId:T()},function(e){r(e)},function(e){n.error(e)})},d.getTasks=function(e,t,r){u.query({filter:e,groupId:t.groupId,eId:h(t.groupId)},function(e){r(e)},function(e){n.error(e)})},d.activeSaveGroup=function(t,r,o,i,e,n){"open"===n?D(o.item):!0===e?d.removeGroup(o.item):void 0!==i?a.patch({id:i.id},{date:d.dateCursor.toServerDateString(),name:i.value},function(e){o.item.id=i.id,o.item.state=void 0,o.item.name=e.name,d.currentGroupIds=void 0,o.item.tasks=[],d.addTaskButton(o.item),t(e)},function(e){r(e,!0)}):"n"!==o.item.state?a.patch({id:o.item.id},{date:d.dateCursor.toServerDateString(),name:o.item.name},function(e){o.item.name=e.name,t(e)},function(e){r(e)}):(o.form.group.$setDirty(),o.form.$valid&&a.save({date:d.dateCursor.toServerDateString(),name:o.item.name},function(e){o.item.id=e.id,o.item.state=void 0,o.item.name=e.name,d.currentGroupIds=void 0,o.item.tasks=[],d.addTaskButton(o.item),t(e)},function(e){r(e)}))},d.activeSaveTask=function(t,r,o,i,e,n){"open"===n?D(o.item):!0===e?d.removeTask(o.item):void 0!==i?c.patch({id:i.id},{date:d.dateCursor.toServerDateString(),name:i.value},function(e){o.item.id=i.id,o.item.state=void 0,o.item.name=e.name,d.currentTaskIds[o.item.groupId]=void 0,t(e)},function(e){r(e,!0)}):"n"!==o.item.state?c.patch({id:o.item.id},{name:o.item.name},function(e){o.item.name=e.name,t(e)},function(e){r(e)}):(o.form.task.$setDirty(),o.form.$valid&&c.save({date:d.dateCursor.toServerDateString(),name:o.item.name,groupId:o.item.groupId},function(e){o.item.id=e.id,o.item.state=void 0,o.item.name=e.name,d.currentTaskIds[o.item.groupId]=void 0,t(e)},function(e){r(e)}))};var m=new Mutex;d.activeSaveTaskItem=function(r,o,i,e,t,n){m.acquire().then(function(t){"focus"===n?(D(i.item),t()):i.item.taskItemId?s.patch({id:i.item.taskItemId},{time:i.item.time?i.item.time:0},function(e){i.item.weekTaskTotal=e.weekTotal,i.item.monthTaskTotal=e.monthTotal,f(i.item,i.item.groupId),f(),t(),r&&r(e)},function(e){t(),o&&o(e)}):(i.form.taskItem.$setDirty(),i.form.$valid?s.save({date:d.dateCursor.toServerDateString(),time:i.item.time,taskId:i.item.id},function(e){i.item.taskItemId=e.id,i.item.weekTaskTotal=e.weekTotal,i.item.monthTaskTotal=e.monthTotal,f(i.item,i.item.groupId),f(),t(),r&&r(e)},function(e){t(),o&&o(e)}):t())})},d.changeItem=function(e,t){e.state=t},d.addGroup=function(e){var t=d.pageItems.indexOf(e),r=new Object;r.uniqId="u"+p++,r.state="n",r.type="g",r.dayTaskTotal=0,r.weekTaskTotal=0,r.monthTaskTotal=0,d.pageItems.splice(t,0,r)},d.addTask=function(e){var t=d.pageItems.indexOf(e),r=new Object;r.groupId=e.groupId,r.uniqId="u"+p++,r.state="n",r.type="t",r.weekTaskTotal=0,r.monthTaskTotal=0,d.pageItems.splice(t,0,r)},d.addTaskButton=function(e){var t=d.pageItems.indexOf(e),r=new Object;r.groupId=e.id,r.uniqId="u"+p++,r.state="b",r.type="t",d.pageItems.splice(t+1,0,r)},d.removeGroup=function(t){t.id?a.remove({id:t.id},{date:d.dateCursor.toServerDateString(),name:t.name},function(e){d.currentGroupIds=void 0,f(),v(t)},function(e){n.error(e)}):v(t)},d.removeTask=function(r){if(r.id)c.remove({id:r.id},{date:d.dateCursor.toServerDateString(),name:r.name,groupId:r.groupId},function(e){d.currentTaskIds[r.groupId]=void 0,f(r,r.groupId),f();var t=d.pageItems.indexOf(r);d.pageItems.splice(t,1)},function(e){n.error(e)});else{var e=d.pageItems.indexOf(r);d.pageItems.splice(e,1)}},d.showTimerDialog=function(e,t){d.timerData={item:e,form:t},void 0===d.timerData.item.calcBrakeTime&&(d.timerData.item.calcBrakeTime=0),void 0===d.timerData.item.calcTime&&(d.timerData.item.calcTime=0),0<=d.timerData.item.time&&(void 0===d.timerData.item.calcFromTime&&(d.timerData.item.calcFromTime=0),1440<d.timerData.item.calcFromTime+d.timerData.item.time&&(d.timerData.item.calcFromTime=0),d.timerData.item.calcToTime=d.timerData.item.calcFromTime+d.timerData.item.time),d.showTimerDialogToggle=!0},d.saveCalcTime=function(){d.activeSaveTaskItem(null,null,d.timerData,null,null,"focus"),d.timerData.item.time=d.timerData.item.calcTime,d.activeSaveTaskItem(d.closeCalcTime,d.closeCalcTime,d.timerData)},d.cancelTimerDialog=function(){d.closeCalcTime()},d.closeCalcTime=function(){d.showTimerDialogToggle=!1},d.activeCalcTime=function(e,t,r){if(0<d.timerData.item.calcToTime){void 0===d.timerData.item.calcFromTime&&(d.timerData.item.calcFromTime=0);var o=Number(d.timerData.item.calcToTime-d.timerData.item.calcFromTime);0<=d.timerData.item.calcBrakeTime&&(o-=d.timerData.item.calcBrakeTime),o<0&&(o=0),d.timerData.item.calcTime=o}};var g=function(){d.loading=!0,o.query({date:d.dateCursor.toServerDateString(),cuid:d.changedUniqIds},function(e){d.currentGroupIds=void 0,d.currentTaskIds=[],d.changedUniqIds=[],d.pageItems=e,d.loading=!1},function(e){n.error(e)}),f()},f=function(t,e){if(void 0!==t)for(var r,o=d.pageItems,i=o.indexOf(t);0<=i;i--)if("g"===o[i].type){r=o[i];break}l.get({date:d.dateCursor.toServerDateString(),groupId:void 0!==t?e:null},function(e){void 0!==t?void 0!==r&&(r.dayTaskTotal=e.dayTotal,r.weekTaskTotal=e.weekTotal,r.monthTaskTotal=e.monthTotal):(d.dayTotal=e.dayTotal,d.weekTotal=e.weekTotal,d.monthTotal=e.monthTotal)},function(e){n.error(e)})},v=function(e){for(var t=d.pageItems,r=1,o=t.indexOf(e),i=o+1,n=t.length;i<n&&"g"!==t[i].type;i++)"t"===t[i].type&&r++;t.splice(o,r)},T=function(){if(d.pageItems){if(d.currentGroupIds)return d.currentGroupIds;for(var e,t=d.pageItems,r=[],o=0,i=t.length;o<i;o++)"g"===(e=t[o]).type&&void 0===e.state&&r.push(e.id);return d.currentGroupIds=r}return d.currentGroupIds=void 0,null},h=function(e){if(d.pageItems){if(d.currentTaskIds[e])return d.currentTaskIds[e];for(var t,r=d.pageItems,o=[],i=0,n=r.length;i<n;i++)"t"===(t=r[i]).type&&t.groupId===e&&void 0!==t.id&&o.push(t.id);return d.currentTaskIds[e]=o}return d.currentTaskIds=[],null},D=function(e){var t=e.uniqId,r=d.changedUniqIds;r.includes(t)||r.push(t)};o=e.getService("./api/dashboard"),a=e.getService("./api/dashboardGroup"),c=e.getService("./api/dashboardTask"),s=e.getService("./api/dashboardTaskItem"),l=e.getService("./api/dashboardTotal"),i=e.getService("./api/filtergroup"),u=e.getService("./api/filtertask"),g()}angular.module("app").controller("timeController",e),e.$inject=["notificationFactory","restService","$interval","$scope"]}(),function(){"use strict";function e(E,I){return{restrict:"A",require:["ngModel"],scope:{activeSave:"&",activeSaveData:"=",activeSaveModel:"=",activeSaveForm:"=",activeSaveMode:"@",focusEvent:"@",model:"=ngModel"},link:function(t,r,e,o){var i=o[0],n=!1,a=!0,c=null,s=null,l=null,u=null,d=null,p=!1;r.bind("focus",function(e){"true"===t.focusEvent&&t.activeSave()(null,null,m(),null,null,"focus"),t.bindEvents(),e.preventDefault(),D(!0),p=!1}),t.bindModelEvent=function(){t.$watch("model",function(e,t){a&&(h(!0),a=!1),i.setServerErrorValidity(!0),!a&&(p||i.$valid&&i.$dirty)&&g()})},"instant"===t.activeSaveMode&&t.bindModelEvent(),t.bindEvents=function(){n||(n=!0,"instant"!==t.activeSaveMode&&t.bindModelEvent(),r.bind("blur",function(e){e.preventDefault(),D()}),r.bind("keydown",function(e){13==e.which?("TEXTAREA"!=r.context.tagName||e.ctrlKey)&&i.$valid&&(e.preventDefault(),e.stopPropagation(),r.blur()):27==e.which&&(e.preventDefault(),e.stopPropagation(),S(),e.target.blur())}))},i.setServerErrorValidity=function(e,t){i.serverError=e?"":t.join?t.join(", "):t,i.$setValidity("serverError",e)},i.setModalValue=function(e){t.model=e,t.$apply()};var m=function(){return void 0!==t.activeSaveData?t.activeSaveData:{item:t.activeSaveModel,form:t.activeSaveForm}},g=function(){c&&I.cancel(c),c=I(function(){f()},0)},f=function(){(p||i.$valid&&i.$dirty)&&(b(d,t.model)||(d=angular.copy(t.model),t.activeSave()(v,T,m())))},v=function(e){h(!1)},T=function(e){if(e&&e.data&&angular.isObject(e.data))for(var t in e.data){i.setServerErrorValidity(!1,e.data[t]),e.isHandled=!0;break}else E.error(e)},h=function(e){e&&(l=angular.copy(t.model)),b(u,t.model)||(u=angular.copy(t.model))},D=function(e){e?s&&I.cancel(s):(s&&I.cancel(s),s=I(function(){y()},4e3))},y=function(){p||i.$valid||!i.$dirty||S()},S=function(){l?(i.setModalValue(l),i.$setDirty()):a&&!p&&(i.$setPristine(),i.setModalValue(u))},b=function(e,t){if(angular.isDate(e)&&angular.isDate(t)){if(e.getTime()==t.getTime())return!0}else if(e==t)return!0;return!1}}}}angular.module("app").directive("activeSave",e),e.$inject=["notificationFactory","$timeout"]}(),function(){"use strict";function e(a){return{restrict:"E",replace:!0,scope:{update:"&",model:"=ngModel"},link:function(r,e,t){e.html('<div ng-form="dateCursorForm" class="date-select"><div class="input-group"><span class="input-group-btn" style="vertical-align: bottom"><button class="btn btn-invisible glyphicon glyphicon-menu-left" type="button" translate-once-title="GENERAL.DATE_SELECT.BACK" ng-click="back()" /><button class="btn btn-invisible glyphicon glyphicon-calendar" type="button" translate-once-title="GENERAL.DATE_SELECT.SELECT" ng-click="toggleDatepicker($event)" /><input type="text" style="position: absolute; bottom: 0px; left: 37px; padding: 0px; margin: 0px; line-height: 0px; height: 0px; width: 0px; visibility: hidden" uib-datepicker-popup show-button-bar="true" datepicker-popup-template-url="ui/template/datepicker/popup.html" current-text="{{\'GENERAL.DATE_SELECT.TODAY\'|translate}}" is-open="openDatepicker" ng-model="hiddenDateModel" /></span><strong><input name="dateCursor" type="text" class="form-control text-center strong" active-save="updateDateCursor" active-save-mode="instant" date-format required ng-model="model" /></strong><span class="input-group-btn"><button class="btn btn-invisible glyphicon glyphicon-record" type="button" translate-once-title="GENERAL.DATE_SELECT.TODAY" ng-click="today()" /><button class="btn btn-invisible glyphicon glyphicon-menu-right" type="button" translate-once-title="GENERAL.DATE_SELECT.FORWARD" ng-click="forward()" /></span></div><field-error class="text-center" field="dateCursorForm.dateCursor" /></div>').show(),a(e.contents())(r);var o=r.dateCursorForm.dateCursor;r.$watch("hiddenDateModel",function(e,t){n(e,r.model)&&i(e)}),r.$watch("model",function(e,t){n(e,r.hiddenDateModel)&&(r.hiddenDateModel=e)}),r.openDatepicker=!1,r.updateDateCursor=function(e,t){r.update()(e,t)},r.back=function(){null===r.model||void 0===r.model?r.today():i(new Date(r.model).addDays(-1))},r.forward=function(){null===r.model||void 0===r.model?r.today():i(new Date(r.model).addDays(1))},r.today=function(){i((new Date).toDateOnly())},r.toggleDatepicker=function(e){e.preventDefault(),r.openDatepicker?r.openDatepicker=!1:r.openDatepicker=!0};var i=function(e){if(!o.setModalDateAndDirty)throw"Error. Missing the method setModalDateAndDirty. Probably dateFormat directive is required.";r.model!=e&&o.setModalDateAndDirty(e)},n=function(e,t){if(null==e)return!1;if(angular.isDate(e)&&angular.isDate(t)){if(e.getTime()!=t.getTime())return!0}else if(angular.isDate(e)&&!angular.isDate(t))return!0;return!1}}}}angular.module("app").directive("dateDaySelect",e),e.$inject=["$compile"]}(),function(){"use strict";function e(s){return{restrict:"E",replace:!0,scope:{update:"&",dividedScale:"=",model:"=ngModel"},link:function(i,e,t){e.html('<div ng-form="dateCursorForm" class="date-select"><div class="input-group"><span class="input-group-btn" style="vertical-align: bottom"><button ng-show="!dividedScale" class="btn btn-invisible glyphicon glyphicon-menu-left" type="button" translate-once-title="GENERAL.DATE_SELECT.BACK" ng-click="back()" /><button class="btn btn-invisible glyphicon glyphicon-calendar" type="button" translate-once-title="GENERAL.DATE_SELECT.SELECT" ng-click="toggleDatepickerFrom($event)" /><input type="text" style="position: absolute; bottom: 0px; left: 37px; padding: 0px; margin: 0px; line-height: 0px; height: 0px; width: 0px; visibility: hidden" uib-datepicker-popup datepicker-options="{minMode: \'month\', datepickerMode: \'month\'}" show-button-bar="true" datepicker-popup-template-url="ui/template/datepicker/popup.html" current-text="{{\'GENERAL.DATE_SELECT.TODAY\'|translate}}" is-open="openDatepickerFrom" ng-model="hiddenDateModelFrom" /><input type="text" style="position: absolute; bottom: 0px; left: 37px; padding: 0px; margin: 0px; line-height: 0px; height: 0px; width: 0px; visibility: hidden" uib-datepicker-popup show-button-bar="true" datepicker-popup-template-url="ui/template/datepicker/popup.html" current-text="{{\'GENERAL.DATE_SELECT.TODAY\'|translate}}" is-open="openDatepickerFromScale" ng-model="hiddenDateModelFrom" /></span><strong><input name="dateCursorFrom" type="text" class="form-control text-center strong" active-save="updateDateCursor" active-save-mode="instant" date-format format="month" required ng-model="model.from" /></strong><span ng-show="dividedScale" class="input-group-btn" style="vertical-align: bottom"><span class="input-group-addon">-</span></span><span ng-show="dividedScale" class="input-group-btn" style="vertical-align: bottom"><button class="btn btn-invisible glyphicon glyphicon-calendar" type="button" translate-once-title="GENERAL.DATE_SELECT.SELECT" ng-click="toggleDatepickerTo($event)" /><input type="text" style="position: absolute; bottom: 0px; left: 37px; padding: 0px; margin: 0px; line-height: 0px; height: 0px; width: 0px; visibility: hidden" uib-datepicker-popup show-button-bar="true" datepicker-popup-template-url="ui/template/datepicker/popup.html" current-text="{{\'GENERAL.DATE_SELECT.TODAY\'|translate}}" is-open="openDatepickerTo" ng-model="hiddenDateModelTo" /></span><strong ng-show="dividedScale"><input name="dateCursorTo" type="text" class="form-control text-center strong" active-save="updateDateCursorTo" active-save-mode="instant" date-format required ng-model="model.to" /></strong><span class="input-group-btn"><button class="btn btn-invisible glyphicon glyphicon-scale" style="Display: none" type="button" translate-once-title="GENERAL.DATE_SELECT.CHANGE_SCALE" ng-click="changeScale()" /><button class="btn btn-invisible glyphicon glyphicon-record" type="button" translate-once-title="GENERAL.DATE_SELECT.TODAY" ng-click="today()" /><button ng-show="!dividedScale" class="btn btn-invisible glyphicon glyphicon-menu-right" type="button" translate-once-title="GENERAL.DATE_SELECT.FORWARD" ng-click="forward()" /></span></div><field-error class="text-center" field="dateCursorForm.dateCursorFrom" /><field-error class="text-center" field="dateCursorForm.dateCursorTo" /></div>').show(),s(e.contents())(i);var n=i.dateCursorForm.dateCursorFrom,o=i.dateCursorForm.dateCursorTo;i.$watch("hiddenDateModelFrom",function(e,t){r(e,i.model.from)&&a(e)}),i.$watch("hiddenDateModelTo",function(e,t){r(e,i.model.to)&&c(e)}),i.$watch("model.from",function(e,t){r(e,i.hiddenDateModelFrom)&&(i.hiddenDateModelFrom=e)}),i.$watch("model.to",function(e,t){i.dividedScale&&r(e,i.hiddenDateModelTo)&&(i.hiddenDateModelTo=e)}),i.openDatepickerFrom=!1,i.openDatepickerFromScale=!1,i.openDatepickerTo=!1,i.updateDateCursor=function(e,t){i.update()(e,t)},i.updateDateCursorTo=function(e,t){i.update()(e,t)},i.changeScale=function(){var e=!i.dividedScale;e?n.setFormat("day"):(n.setFormat("month"),a(i.model.from.toDateOnlyFirstDayInMonth(),!0)),i.dividedScale=e},i.back=function(){null===i.model.from||void 0===i.model.from?i.today():a(new Date(i.model.from.toDateOnlyFirstDayInMonth()).addMonths(-1),!0)},i.forward=function(){null===i.model.from||void 0===i.model.from?i.today():a(new Date(i.model.from.toDateOnlyFirstDayInMonth()).addMonths(1),!0)},i.today=function(){var e=new Date;a(e.toDateOnlyFirstDayInMonth(),!0)},i.toggleDatepickerFrom=function(e){e.preventDefault(),i.dividedScale?i.openDatepickerFromScale?i.openDatepickerFromScale=!1:(i.openDatepickerTo=!1,i.openDatepickerFrom=!1,i.openDatepickerFromScale=!0):i.openDatepickerFrom?i.openDatepickerFrom=!1:(i.openDatepickerTo=!1,i.openDatepickerFromScale=!1,i.openDatepickerFrom=!0)},i.toggleDatepickerTo=function(e){e.preventDefault(),i.openDatepickerTo?i.openDatepickerTo=!1:(i.openDatepickerFrom=!1,i.openDatepickerFromScale=!1,i.openDatepickerTo=!0)};var a=function(e,t,r){if(!n.setModalDateFromAndDirty)throw"Error. Missing the method setModalDateAndDirty. Probably dateFormat directive is required.";if(i.model.from!=e){if(!r)if(!i.dividedScale||t)c(e.toDateOnlyLastDayInMonth(),!0);else if(e<i.model.to){var o=new Date(e).addDays(30);i.model.to>o&&c(o,!0)}else e>i.model.to?c(new Date(e).addDays(30),!0):c(new Date(e).addDays(1),!0);n.setModalDateFromAndDirty(e,r),i.hiddenDateModelFrom=e}},c=function(e,t){if(!o.setModalDateToAndDirty)throw"Error. Missing the method setModalDateAndDirty. Probably dateFormat directive is required.";if(i.model.to!=e){if(!t&&i.dividedScale)if(e>i.model.from){var r=new Date(e).addDays(-30);i.model.from<r&&a(r,!0)}else e<i.model.from?a(new Date(e).addDays(-30),!0):a(new Date(e).addDays(-1),!0);o.setModalDateToAndDirty(e,t),i.hiddenDateModelTo=e}},r=function(e,t){if(null==e)return!1;if(angular.isDate(e)&&angular.isDate(t)){if(e.getTime()!=t.getTime())return!0}else if(angular.isDate(e)&&!angular.isDate(t))return!0;return!1}}}}angular.module("app").directive("dateMonthSelect",e),e.$inject=["$compile"]}(),function(){"use strict";function e(a){return{restrict:"E",replace:!0,scope:{update:"&",datepickerMode:"@",model:"=ngModel"},link:function(r,e,t){"month"==r.datepickerMode?e.html('<div ng-form="dateCursorForm" class="date-select"><div class="input-group"><span class="input-group-btn" style="vertical-align: bottom"><button class="btn btn-invisible glyphicon glyphicon-menu-left" type="button" translate-once-title="GENERAL.DATE_SELECT.BACK" ng-click="back()" /><button class="btn btn-invisible glyphicon glyphicon-calendar" type="button" translate-once-title="GENERAL.DATE_SELECT.SELECT" ng-click="toggleDatepicker($event)" /><input type="text" style="position: absolute; bottom: 0px; left: 37px; padding: 0px; margin: 0px; line-height: 0px; height: 0px; width: 0px; visibility: hidden" uib-datepicker-popup datepicker-options="{minMode: \'month\', datepickerMode: \'month\'}" show-button-bar="true" datepicker-popup-template-url="ui/template/datepicker/popup.html" current-text="{{\'GENERAL.DATE_SELECT.TODAY\'|translate}}" is-open="openDatepicker" ng-model="hiddenDateModel" /></span><strong><input name="dateCursor" type="text" class="form-control text-center strong" active-save="updateDateCursor" active-save-mode="instant" date-format format="month" required ng-model="model" /></strong><span class="input-group-btn"><button class="btn btn-invisible glyphicon glyphicon-record" type="button" translate-once-title="GENERAL.DATE_SELECT.TODAY" ng-click="today()" /><button class="btn btn-invisible glyphicon glyphicon-menu-right" type="button" translate-once-title="GENERAL.DATE_SELECT.FORWARD" ng-click="forward()" /></span></div><field-error class="text-center" field="dateCursorForm.dateCursor" /></div>').show():e.html('<div ng-form="dateCursorForm" class="date-select"><div class="input-group"><span class="input-group-btn" style="vertical-align: bottom"><button class="btn btn-invisible glyphicon glyphicon-menu-left" type="button" translate-once-title="GENERAL.DATE_SELECT.BACK" ng-click="back()" /><button class="btn btn-invisible glyphicon glyphicon-calendar" type="button" translate-once-title="GENERAL.DATE_SELECT.SELECT" ng-click="toggleDatepicker($event)" /><input type="text" style="position: absolute; bottom: 0px; left: 37px; padding: 0px; margin: 0px; line-height: 0px; height: 0px; width: 0px; visibility: hidden" uib-datepicker-popup show-button-bar="true" datepicker-popup-template-url="ui/template/datepicker/popup.html" current-text="{{\'GENERAL.DATE_SELECT.TODAY\'|translate}}" is-open="openDatepicker" ng-model="hiddenDateModel" /></span><strong><input name="dateCursor" type="text" class="form-control text-center strong" active-save="updateDateCursor" active-save-mode="instant" date-format required ng-model="model" /></strong><span class="input-group-btn"><button class="btn btn-invisible glyphicon glyphicon-record" type="button" translate-once-title="GENERAL.DATE_SELECT.TODAY" ng-click="today()" /><button class="btn btn-invisible glyphicon glyphicon-menu-right" type="button" translate-once-title="GENERAL.DATE_SELECT.FORWARD" ng-click="forward()" /></span></div><field-error class="text-center" field="dateCursorForm.dateCursor" /></div>').show(),a(e.contents())(r);var o=r.dateCursorForm.dateCursor;r.$watch("hiddenDateModel",function(e,t){n(e,r.model)&&i(e)}),r.$watch("model",function(e,t){n(e,r.hiddenDateModel)&&(r.hiddenDateModel=e)}),r.openDatepicker=!1,r.updateDateCursor=function(e,t){r.update()(e,t)},r.back=function(){null===r.model||void 0===r.model?r.today():"month"==r.datepickerMode?i(new Date(r.model).addMonths(-1)):i(new Date(r.model).addDays(-1))},r.forward=function(){null===r.model||void 0===r.model?r.today():"month"==r.datepickerMode?i(new Date(r.model).addMonths(1)):i(new Date(r.model).addDays(1))},r.today=function(){"month"==r.datepickerMode?i((new Date).toDateOnlyFirstDayInMonth()):i((new Date).toDateOnly())},r.toggleDatepicker=function(e){e.preventDefault(),e.stopPropagation(),r.openDatepicker?r.openDatepicker=!1:r.openDatepicker=!0};var i=function(e){if(!o.setModalDateAndDirty)throw"Error. Missing the method setModalDateAndDirty. Probably dateFormat directive is required.";r.model!=e&&o.setModalDateAndDirty(e)},n=function(e,t){if(null==e)return!1;if(angular.isDate(e)&&angular.isDate(t)){if(e.getTime()!=t.getTime())return!0}else if(angular.isDate(e)&&!angular.isDate(t))return!0;return!1}}}}angular.module("app").directive("dateSelect",e),e.$inject=["$compile"]}(),function(){"use strict";angular.module("app").directive("datepicker",function(){return{restrict:"E",require:["ngModel"],transclude:!0,scope:{model:"=ngModel"},template:'<div class="input-group"><input type="text" style="position: absolute; bottom: 0px; left: 0px; padding: 0px; margin: 0px; line-height: 0px; height: 0px; width: 0px; visibility: hidden" uib-datepicker-popup show-button-bar="true" datepicker-popup-template-url="ui/template/datepicker/popup.html" current-text="{{\'GENERAL.DATE_SELECT.TODAY\'|translate}}" is-open="openDatepicker" ng-model="model" /><span ng-transclude></span><span class="input-group-btn"><button  style="margin-right: 0px" class="btn btn-invisible glyphicon glyphicon-calendar" type="button" translate-once-title="GENERAL.DATE_SELECT.SELECT" ng-click="toggleDatepicker($event)" /></span></div>',link:function(t,e,r,o){t.openDatepicker=!1,t.toggleDatepicker=function(e){e.preventDefault(),e.stopPropagation(),t.openDatepicker?t.openDatepicker=!1:t.openDatepicker=!0}}}})}(),function(){"use strict";angular.module("app").directive("fieldError",function(){return{restrict:"E",replace:!0,scope:{field:"=field"},template:'<div><div class="error-block" ng-messages="field.$error" ng-if="field.$dirty"><div ng-messages-include="error-messages"></div><div ng-message="serverError">{{field.serverError}}</div></div></div>'}})}(),function(){"use strict";function e(i){return{restrict:"A",link:function(t,e,r){var o=i(r.fileChange);e[0].addEventListener("change",function(e){t.$apply(function(){o(t,{$event:e,files:e.target.files})})},!1)}}}angular.module("app").directive("fileChange",e),e.$inject=["$parse"]}(),function(){"use strict";function e(o,e){var i=[];i.currentUser=[],i.currentOrganization=[],i.currentLogo=[],i.currentUser.getService=function(){return{getUser:function(e,t){return r(e,t),i.currentUser.user},saveFullName:function(e,t,r){i.currentUser.service.patch({id:i.currentUser.user.id},{fullName:e},function(e){i.currentUser.user.fullName=e.fullName,t&&t(e)},function(e){r?r(e):o.error(e)})},savePassword:function(e,t,r){i.currentUser.service.patch({id:i.currentUser.user.id},{password:e},function(e){t&&t(e)},function(e){r?r(e):o.error(e)})}}},i.currentOrganization.getService=function(){return{getOrganization:function(e,t){return n(e,t),i.currentOrganization.organization},saveName:function(e,t,r){i.currentOrganization.service.patch({id:0},{name:e},function(e){i.currentOrganization.organization.name=e.name,t&&t(e)},function(e){r?r(e):o.error(e)})},saveAddress:function(e,t,r){i.currentOrganization.service.patch({id:0},{address:e},function(e){i.currentOrganization.organization.address=e.address,t&&t(e)},function(e){r?r(e):o.error(e)})},saveVatNumber:function(e,t,r){i.currentOrganization.service.patch({id:0},{vatNumber:e},function(e){i.currentOrganization.organization.vatNumber=e.vatNumber,t&&t(e)},function(e){r?r(e):o.error(e)})},savePaymentDetails:function(e,t,r){i.currentOrganization.service.patch({id:0},{paymentDetails:e},function(e){i.currentOrganization.organization.paymentDetails=e.paymentDetails,t&&t(e)},function(e){r?r(e):o.error(e)})},saveTaxPercentage:function(e,t,r){i.currentOrganization.service.patch({id:0},{taxPercentage:e},function(e){i.currentOrganization.organization.taxPercentage=e.taxPercentage,t&&t(e)},function(e){r?r(e):o.error(e)})},saveVatPercentage:function(e,t,r){i.currentOrganization.service.patch({id:0},{vatPercentage:e},function(e){i.currentOrganization.organization.vatPercentage=e.vatPercentage,t&&t(e)},function(e){r?r(e):o.error(e)})},saveFirstInvoiceNumber:function(e,t,r){i.currentOrganization.service.patch({id:0},{firstInvoiceNumber:e},function(e){i.currentOrganization.organization.firstInvoiceNumber=e.firstInvoiceNumber,t&&t(e)},function(e){r?r(e):o.error(e)})},saveCulture:function(e,t,r){i.currentOrganization.service.patch({id:0},{culture:e},function(e){i.currentOrganization.organization.culture=e.culture,t&&t(e)},function(e){r?r(e):o.error(e)})}}},i.currentLogo.getService=function(){return{getLogo:function(e,t){c(e,t)},saveLogo:function(e,t,r){i.currentLogo.service.save({image:e},function(e){i.currentLogo.logo=e.image,t&&t(i.currentLogo.logo)},function(e){r?r(e):o.error(e)})}}};var r=function(t,r){i.currentUser.user?setTimeout(t,0):i.currentUser.user=i.currentUser.service.get({id:-1},function(e){t&&t(e)},function(e){r?r(e):o.error(e)})},n=function(t,r){i.currentOrganization.organization?setTimeout(t,0):i.currentOrganization.organization=i.currentOrganization.service.get({},function(e){a(i.currentOrganization.organization),t&&t(e)},function(e){r?r(e):o.error(e)})},a=function(e){"en-US"==e.culture?(e.tax=!0,e.vat=!1,e.taxPercentage=e.taxPercentage?e.taxPercentage:0):(e.tax=!1,e.vat=!0,e.vatPercentage=e.vatPercentage?e.vatPercentage:0)},c=function(t,r){i.currentLogo.logo?setTimeout(function(){t&&t(i.currentLogo.logo)},0):i.currentLogo.service.get({},function(e){i.currentLogo.logo=e.image,t&&t(i.currentLogo.logo)},function(e){r?r(e):o.error(e)})};return i.currentUser.service=e.getService("./api/user"),i.currentOrganization.service=e.getService("./api/organization"),i.currentLogo.service=e.getService("./api/logo"),setTimeout(function(){r(),n()},2e3),setTimeout(function(){c()},1e4),i}angular.module("app").service("genericDataFactory",e),e.$inject=["notificationFactory","restService"]}(),function(){"use strict";function e(c){return{restrict:"C",require:["ngModel","^?groupTaskDropdown"],scope:{setFocus:"@",model:"=ngModel"},link:function(t,r,e,o){var i=o[0],n=!1,a=o[1];r.bind("focus",function(e){t.bindEvents(),a&&(e.stopPropagation(),a.open())}),r.bind("click",function(e){a&&e.stopPropagation()}),t.bindEvents=function(){n||(n=!0,t.$watch("model",function(e){i.setServerErrorValidity(!0)}),r.bind("keydown",function(e){13==e.which?i.$valid&&(e.preventDefault(),e.stopPropagation(),a&&a.save(),r.blur()):27==e.which&&(e.preventDefault(),e.stopPropagation(),a&&a.cancel(),e.target.blur())}))},i.setServerErrorValidity=function(e,t){i.serverError=e?"":t.join?t.join(", "):t,i.$setValidity("serverError",e)},i.setModalValue=function(e){t.model=e,t.$apply()},"true"===t.setFocus&&c(function(){r.focus()},0)}}}angular.module("app").directive("inactiveSave",e),e.$inject=["$timeout"]}(),angular.module("logToServer",[]).service("$log",function(){this.log=function(e){JL("Angular").trace(e)},this.debug=function(e){JL("Angular").debug(e)},this.info=function(e){JL("Angular").info(e)},this.warn=function(e){JL("Angular").warn(e)},this.error=function(e){JL("Angular").error(e)}}).factory("$exceptionHandler",function(){return function(e,t){throw JL("Angular").fatalException(t,e),e}}).factory("logToServerInterceptor",["$q",function(t){return{request:function(e){return e.msBeforeAjaxCall=(new Date).getTime(),e},response:function(e){if(e.config.warningAfter){var t=(new Date).getTime()-e.config.msBeforeAjaxCall;t>e.config.warningAfter&&JL("Angular.Ajax").warn({timeTakenInMs:t,config:e.config,data:e.data})}return e},responseError:function(e){return t.reject(e)}}}]),function(){"use strict";function e(n,r,a){return{template:'<div><div ng-click="onClick($event)" class="form-control" style="height: 128px; width: 168px"><div ng-if="!model" class="placeholder" translate-once="GENERAL.LOGO.YOUR_LOGO"></div><img id="imgLogo" translate-once-title="GENERAL.LOGO.YOUR_LOGO" ng-src="{{model}}" ng-if="model" /></div><label tabindex="-1" style="visibility: hidden; position: absolute; overflow: hidden; width: 0px; height: 0px; border: none; margin: 0px; padding: 0px;">upload<input type="file" accept="image/*" ></label></div>',restrict:"E",transclude:!0,replace:!0,scope:{model:"=ngModel"},link:function(o,t,e){var i;o.onClick=function(e){e.stopPropagation(),e.preventDefault(),t[0].childNodes[1].childNodes[1].click()};t.bind("change",function(e){"undefined"==typeof FileReader&&a("GENERAL.LOGO.NOT_SUPPORTED").then(function(e){n.error(e)});var t=e.target.files[0];if(t&&t.type.match("image.*"))if(5e5<t.size)a("GENERAL.LOGO.SIZE_ERROR").then(function(e){n.error(e)});else{var r=new FileReader;r.onload=function(e){i.saveLogo(e.target.result,function(e){e&&(o.model=e)})},r.readAsDataURL(t)}});(i=r.currentLogo.getService()).getLogo(function(e){e&&(o.model=e)})}}}angular.module("app").directive("logoFile",e),e.$inject=["notificationFactory","genericDataFactory","$translate"]}(),function(){"use strict";angular.module("app").directive("modal",function(){return{template:'<div class="modal fade"><div class="modal-dialog {{ mSizes ? mSizes : \'\' }}"><div class="modal-content"><div class="modal-header"> {{ mTitle }}<button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button></div><div class="modal-body" ng-transclude></div></div></div></div>',restrict:"E",transclude:!0,replace:!0,scope:{mVisible:"=",mTitle:"@",mSizes:"@"},link:function(e,t,r){e.$watch("mVisible",function(){1==e.mVisible?$(t).modal("show"):$(t).modal("hide")}),$(t).on("hidden.bs.modal",function(){e.$apply(function(){e.mVisible=!1})})}}})}(),function(){"use strict";angular.module("app").factory("notificationFactory",function(){return{success:function(e){toastr.options={showDuration:"100",hideDuration:"0",timeOut:"2000",extendedTimeOut:"3000",positionClass:"toast-top-center"},toastr.clear(),toastr.options={showDuration:"100",hideDuration:"100",timeOut:"2000",extendedTimeOut:"3000",positionClass:"toast-top-center"},void 0===e&&(e="Success."),toastr.success(e)},error:function(e){var t;if(e){if(!0===e.isHandled)return;var r=!0;if(e.length&&0<e.length)t=e,r=!1;else if(e&&e.data&&angular.isObject(e.data))for(var o in e.data){t=e.data[o];break}r&&e.status&&(t||(t="Http status "+e.status+". "+e.statusText))}toastr.options={showDuration:"100",hideDuration:"100",timeOut:"6000",extendedTimeOut:"8000",positionClass:"toast-top-center"},void 0===t&&(t="Unknown error occurred."),toastr.error(t)},warning:function(e){toastr.options={showDuration:"100",hideDuration:"100",timeOut:"6000",extendedTimeOut:"8000",positionClass:"toast-top-center"},void 0===e&&(e="Unknown warning occurred."),toastr.warning(e)}}})}(),function(){"use strict";function e(t){this.getService=function(e){if(""===e)throw"Invalid end point";return t(e+"/:id",{id:"@id"},{get:{method:"GET",interceptor:{responseError:r},timeout:1e4,warningAfter:8e3},save:{method:"POST",interceptor:{responseError:r},timeout:8e3,warningAfter:5e3},query:{method:"GET",interceptor:{responseError:r},timeout:8e3,warningAfter:5e3,isArray:!0},update:{method:"PUT",interceptor:{responseError:r},timeout:8e3,warningAfter:5e3},patch:{method:"PATCH",interceptor:{responseError:r},timeout:8e3,warningAfter:5e3},remove:{method:"PUT",interceptor:{responseError:r},timeout:8e3,warningAfter:5e3},delete:{method:"DELETE",interceptor:{responseError:r},timeout:8e3,warningAfter:5e3}})};var r=function(e){if(!e.isHandled){var t="timeout";e&&e.status&&e.data&&(t=e.data.ExceptionMessage),JL("Angular.Ajax").fatalException({errorMessage:t,status:e.status,config:e.config},e.data)}}}angular.module("app").service("restService",e),e.$inject=["$resource"]}(),function(){"use strict";function e(g,f){return{restrict:"A",require:["ngModel"],compile:function(e,t){if("INPUT"!==e[0].nodeName)throw"Error. currencyFormat directive must be used inside an <input> element.";return function(e,t,r,o){var i=o[0],n=r.hasOwnProperty("max")&&""!==r.max?parseInt(r.max):9999999,a=r.hasOwnProperty("min")&&""!==r.min?parseInt(r.min):0,c=r.hasOwnProperty("step")&&""!==r.step?parseInt(r.step):1,s=!(!r.hasOwnProperty("fractionSize")||isNaN(r.fractionSize))&&parseInt(r.fractionSize),l=!(!r.hasOwnProperty("hideZero")||"true"!==r.hideZero&&"True"!==r.hideZero);t.on("keydown",function(e){if(38===e.keyCode||40===e.keyCode){e.preventDefault();var t=e.shiftKey?10*c:c;40===e.keyCode&&(t*=-1);var r=null==i.$modelValue||isNaN(i.$modelValue)?t:Number(i.$modelValue)+t;if(!1!==n&&n<r?r=n:!1!==a&&r<a&&(r=a),i.$setDirty(),!i.setModalValue)throw"Error. Missing the method setModalValue. Probably either activeSave or inactiveSave directive is required.";i.setModalValue(r)}}),t.bind("blur",function(e){i.$valid&&m()}),i.$formatters.push(function(e){return l&&0==e?"":0==s?f("currency")(e):f("currency")(e,s)}),i.$parsers.push(function(e){return u(e)}),i.$validators.currency=function(e,t){return null==t||""===t||!!d(t)},i.$validators.min=function(e,t){return!(!1!==a&&e<a)},i.$validators.max=function(e,t){return!(!1!==n&&n<e)};var u=function(e){return e&&!angular.isString(e)&&(e=new String(e)),e&&(e=(e=e.replace(g.NUMBER_FORMATS.CURRENCY_SYM,"")).replace(/\s/g,""),","===g.NUMBER_FORMATS.DECIMAL_SEP&&(e=(e=e.replace(/\./g,"")).replace(/,/g,".")),","===g.NUMBER_FORMATS.GROUP_SEP&&(e=e.replace(/,/g,""))),e},d=function(e){return!(!e||(e=e.replace(g.NUMBER_FORMATS.GROUP_SEP,""),!p().test(e)))},p=function(){var e="\\s*(\\d*|(\\d*(\\"+g.NUMBER_FORMATS.DECIMAL_SEP+"\\d*)))\\s*",t=g.NUMBER_FORMATS.CURRENCY_SYM;return"$"==t&&(t="\\$"),g.NUMBER_FORMATS.PATTERNS[1].posPre?new RegExp("^\\s*("+t+")?"+e+"$"):new RegExp("^"+e+"("+t+")?\\s*$")},m=function(){for(var e=i.$formatters,t=e.length,r=i.$$rawModelValue;t--;)r=e[t](r);i.$setViewValue(r),i.$render()}}}}}angular.module("app").directive("currencyFormat",e),e.$inject=["$locale","$filter"]}(),function(){"use strict";function e(d,p){return{restrict:"A",require:["ngModel"],compile:function(e,t){if("INPUT"!==e[0].nodeName)throw"Error. numberFormat directive must be used inside an <input> element.";return function(r,e,t,o){var i=o[0],n=!(!t.hasOwnProperty("max")||""===t.max)&&new Date(t.max),a=!(!t.hasOwnProperty("min")||""===t.min)&&new Date(t.min),c=t.hasOwnProperty("step")&&""!==t.step?parseInt(t.step):1,s=!(!t.hasOwnProperty("format")||""===t.format)&&t.format;e.on("keydown",function(e){if(38===e.keyCode||40===e.keyCode){e.preventDefault();var t,r=c;if(40===e.keyCode&&(r*=-1),t=null!=i.$modelValue&&angular.isDate(i.$modelValue)?e.shiftKey||"month"==s?new Date(i.$modelValue).addMonths(r):new Date(i.$modelValue).addDays(r):new Date,!1!==n&&n<t?t=n:!1!==a&&t<a&&(t=a),i.$setDirty(),!i.setModalValue)throw"Error. Missing the method setModalValue. Probably either activeSave or inactiveSave directive is required.";i.setModalValue(t)}}),e.bind("blur",function(e){i.$valid&&u()}),i.$formatters.push(function(e){return d("date")(e,l())}),i.$parsers.push(function(e){e&&"month"==s&&(e="01 "+e);var t=p(e,l("month"==s));return void 0!==t?t:null}),i.$validators.date=function(e,t){return null==t||""===t||(t&&"month"==s&&(t="01 "+t),void 0!==p(t,l("month"==s)))},i.$validators.min=function(e,t){return!(!1!==a&&e<a)},i.$validators.max=function(e,t){return!(!1!==n&&n<e)},i.setFormat=function(e){s="month"==e&&"month",i.$valid&&u()},i.setModalDateAndDirty=function(e){r.model=e,i.$setDirty()},i.setModalDateFromAndDirty=function(e,t){r.model.from=e,t||i.$setDirty()},i.setModalDateToAndDirty=function(e,t){r.model.to=e,t||i.$setDirty()};var l=function(e){return!1===s?"mediumDate":"month"==s?e?"dd MMM y":"MMM y":s},u=function(){for(var e=i.$formatters,t=e.length,r=i.$$rawModelValue;t--;)r=e[t](r);i.$setViewValue(r),i.$render()}}}}}angular.module("app").directive("dateFormat",e),e.$inject=["$filter","$dateParser"]}(),function(){"use strict";function e(f,v){return{restrict:"A",require:["ngModel"],compile:function(e,t){if("INPUT"!==e[0].nodeName)throw"Error. numberFormat directive must be used inside an <input> element.";return function(e,t,r,o){var i=o[0],n=!(!r.hasOwnProperty("max")||""===r.max)&&parseInt(r.max),a=!(!r.hasOwnProperty("min")||""===r.min)&&parseInt(r.min),c=r.hasOwnProperty("step")&&""!==r.step?parseInt(r.step):1,s=!(!r.hasOwnProperty("fractionSize")||isNaN(r.fractionSize))&&parseInt(r.fractionSize),l=!(!r.hasOwnProperty("hideZero")||"true"!==r.hideZero&&"True"!==r.hideZero),u=!(!r.hasOwnProperty("wholeNumber")||"true"!==r.wholeNumber&&"True"!==r.wholeNumber);t.on("keydown",function(e){if(38===e.keyCode||40===e.keyCode){e.preventDefault();var t=e.shiftKey?10*c:c;40===e.keyCode&&(t*=-1);var r=null==i.$modelValue||isNaN(i.$modelValue)?t:Number(i.$modelValue)+t;if(!1!==n&&n<r?r=n:!1!==a&&r<a&&(r=a),i.$setDirty(),!i.setModalValue)throw"Error. Missing the method setModalValue. Probably either activeSave or inactiveSave directive is required.";i.setModalValue(r)}}),t.bind("blur",function(e){i.$valid&&g()}),i.$formatters.push(function(e){return l&&0==e?"":0==s?v("number")(e):v("number")(e,s)}),i.$parsers.push(function(e){return d(e)}),i.$validators.number=function(e,t){return null==t||""===t||!!p(t)},i.$validators.min=function(e,t){return!(!1!==a&&e<a)},i.$validators.max=function(e,t){return!(!1!==n&&n<e)},i.$validators.wholeNumber=function(e,t){return!1===u||e%1==0&&!new RegExp(/\./g).test(e)};var d=function(e){return e&&!angular.isString(e)&&(e=new String(e)),e&&(","===f.NUMBER_FORMATS.DECIMAL_SEP&&(e=(e=e.replace(/\./g,"")).replace(/,/g,".")),","===f.NUMBER_FORMATS.GROUP_SEP&&(e=e.replace(/,/g,""))),e},p=function(e){return e&&(e=e.replace(f.NUMBER_FORMATS.GROUP_SEP,"")),!!m().test(e)},m=function(){return"."===f.NUMBER_FORMATS.DECIMAL_SEP?/^\s*(\-|\+)?(\d+|(\d*(\.\d*)))\s*$/:/^\s*(\-|\+)?(\d+|(\d*(\,\d*)))\s*$/},g=function(){for(var e=i.$formatters,t=e.length,r=i.$$rawModelValue;t--;)r=e[t](r);i.$setViewValue(r),i.$render()}}}}}angular.module("app").directive("numberFormat",e),e.$inject=["$locale","$filter"]}(),function(){"use strict";function e(g,f){return{restrict:"A",require:["ngModel"],compile:function(e,t){if("INPUT"!==e[0].nodeName)throw"Error. percentageFormat directive must be used inside an <input> element.";return function(e,t,r,o){var i=o[0],n=!(!r.hasOwnProperty("max")||""===r.max)&&parseInt(r.max),a=!(!r.hasOwnProperty("min")||""===r.min)&&parseInt(r.min),c=r.hasOwnProperty("step")&&""!==r.step?parseInt(r.step):1,s=!(!r.hasOwnProperty("fractionSize")||isNaN(r.fractionSize))&&parseInt(r.fractionSize),l=!(!r.hasOwnProperty("hideZero")||"true"!==r.hideZero&&"True"!==r.hideZero);t.on("keydown",function(e){if(38===e.keyCode||40===e.keyCode){e.preventDefault();var t=e.shiftKey?10*c:c;40===e.keyCode&&(t*=-1);var r=null==i.$modelValue||isNaN(i.$modelValue)?t:Number(i.$modelValue)+t;if(!1!==n&&n<r?r=n:!1!==a&&r<a&&(r=a),i.$setDirty(),!i.setModalValue)throw"Error. Missing the method setModalValue. Probably either activeSave or inactiveSave directive is required.";i.setModalValue(r)}}),t.bind("blur",function(e){i.$valid&&m()}),i.$formatters.push(function(e){return l&&0==e?"":0==s?f("number")(e)+"%":f("number")(e,s)+"%"}),i.$parsers.push(function(e){return u(e)}),i.$validators.percentage=function(e,t){return null==t||""===t||!!d(t)},i.$validators.min=function(e,t){return!(!1!==a&&e<a)},i.$validators.max=function(e,t){return!(!1!==n&&n<e)};var u=function(e){return e&&!angular.isString(e)&&(e=new String(e)),e&&(e=(e=e.replace(/\s/g,"")).replace(/%/g,""),","===g.NUMBER_FORMATS.DECIMAL_SEP&&(e=(e=e.replace(/\./g,"")).replace(/,/g,".")),","===g.NUMBER_FORMATS.GROUP_SEP&&(e=e.replace(/,/g,""))),e},d=function(e){return!!p().test(e)},p=function(){return"."===g.NUMBER_FORMATS.DECIMAL_SEP?/^\s*(\-|\+)?(\d+|(\d*(\.\d*)))\s*%?\s*$/:/^\s*(\-|\+)?(\d+|(\d*(\,\d*)))\s*%?\s*$/},m=function(){for(var e=i.$formatters,t=e.length,r=i.$$rawModelValue;t--;)r=e[t](r);i.$setViewValue(r),i.$render()}}}}}angular.module("app").directive("percentageFormat",e),e.$inject=["$locale","$filter"]}(),function(){"use strict";function e(m,g){return{restrict:"A",require:["ngModel"],compile:function(e,t){if("INPUT"!==e[0].nodeName)throw"Error. timeFormat directive must be used inside an <input> element.";return function(e,t,r,o){var i=o[0],n=!(!r.hasOwnProperty("max")||""===r.max)&&parseInt(r.max),a=r.hasOwnProperty("min")&&""!==r.min?parseInt(r.min):0,c=r.hasOwnProperty("step")&&""!==r.step?parseInt(r.step):1,s=!(!r.hasOwnProperty("hideZero")||"true"!==r.hideZero&&"True"!==r.hideZero);t.on("keydown",function(e){if(38===e.keyCode||40===e.keyCode){e.preventDefault();var t=e.shiftKey?60*c:c;40===e.keyCode&&(t*=-1);var r=null==i.$modelValue||isNaN(i.$modelValue)?t:Number(i.$modelValue)+t;if(!1!==n&&n<r?r=n:!1!==a&&r<a&&(r=a),i.$setDirty(),!i.setModalValue)throw"Error. Missing the method setModalValue. Probably either activeSave or inactiveSave directive is required.";i.setModalValue(r)}}),t.bind("blur",function(e){i.$valid&&p()}),i.$formatters.push(function(e){return s&&0==e?"":g("time")(e)}),i.$parsers.push(function(e){return l(e)}),i.$validators.time=function(e,t){return null==t||""===t||!!u(t)},i.$validators.min=function(e,t){return!(!1!==a&&e<a)},i.$validators.max=function(e,t){return!(!1!==n&&n<e)};var l=function(e){if(e&&!angular.isString(e)&&(e=new String(e)),e)if(-1<e.indexOf(":"))1==(t=e.split(":"))[1].length&&(t[1]=t[1]+"0"),2<t[1].length&&(t[1]=t[1]/Math.pow(10,t[1].length-2)),e=60*Number(t[0])+Number(t[1]);else if(-1<e.indexOf(m.NUMBER_FORMATS.DECIMAL_SEP)){var t;1==(t=e.split(m.NUMBER_FORMATS.DECIMAL_SEP))[1].length&&(t[1]=t[1]+"0"),e=60*Number(t[0])+60*Number(t[1])/100}else e=60*Number(e);return Math.round(e)},u=function(e){return!!d().test(e)},d=function(){return new RegExp("^\\s*((\\d+|(\\d*(\\:\\d*)))|(\\d+|(\\d*(\\"+m.NUMBER_FORMATS.DECIMAL_SEP+"\\d*))))\\s*")},p=function(){for(var e=i.$formatters,t=e.length,r=i.$$rawModelValue;t--;)r=e[t](r);i.$setViewValue(r),i.$render()}}}}}angular.module("app").directive("timeFormat",e),e.$inject=["$locale","$filter"]}(),function(){"use strict";angular.module("app").filter("time",function(){return function(e){if(angular.isDefined(e)&&(e&&!angular.isNumber(e)&&(e=Number(e)),e)){var t=e%60,r=(e-t)/60;e=new String(r)+":"+("0"+t).slice(-2)}return e}})}(),function(){"use strict";function e(o,e,t){var r,i=this;i.showDialog=!1,i.size="",i.showUrlDialog=function(e){i.size="modal-lg",i.url=e,i.showDialog=!0},i.showSupport=function(){i.size="",i.url="./applib/layout/supportPage.html",i.showDialog=!0},i.sendSupportMessage=function(){i.supportForm.message.$setDirty(),i.supportForm.$valid&&r.save({message:i.supportMessage},function(e){t("SUPPORT.CONFIRMATION_TEXT").then(function(e){o.success(e)}),i.showDialog=!1},function(e){if(e&&e.data&&angular.isObject(e.data)){var t=!1;for(var r in e.data)-1!=r.toLowerCase().indexOf("message")&&(t=!0,i.supportForm.message.setServerErrorValidity(!1,e.data[r]));if(t)return void(e.isHandled=!0)}o.error(e)})},i.close=function(){i.showDialog=!1};r=e.getService("./api/support")}angular.module("app").controller("footerController",e),e.$inject=["notificationFactory","restService","$translate"]}(),function(){"use strict";function e(e,t){var r=this;r.getClass=function(e){return"/"===e?"/"===t.path()?"active":"":t.path().substr(0,e.length)===e?"active":""},r.isCollapsed=!0,e.$on("$routeChangeSuccess",function(){r.isCollapsed=!0})}angular.module("app").controller("navController",e),e.$inject=["$scope","$location"]}(),function(){"use strict";Date.prototype.toDateOnly=function(){return new Date(this.toDateString())},Date.prototype.toDateOnlyFirstDayInMonth=function(){return new Date(this.getFullYear(),this.getMonth(),1)},Date.prototype.toDateOnlyLastDayInMonth=function(){return new Date(this.getFullYear(),this.getMonth(),1).addMonths(1).addDays(-1)},Date.prototype.addDays=function(e){return this.setTime(this.getTime()+864e5*e),this},Date.prototype.addMonths=function(e){var t=this.getFullYear(),r=this.getMonth(),o=this.getDate(),i=r+e;if(12<i){var n=i/12;t+=n,r=r+e-12*n}else if(i<1){for(;t-=1,(i+=12)<1;);r=i}else r=i;return new Date(t,r,o)},Date.prototype.toServerDateString=function(){var e=this.getMonth()+1;return this.getFullYear()+"-"+t(e)+"-"+t(this.getDate())+"T00:00:00"};var t=function(e){return e<10?"0"+e:e}}();