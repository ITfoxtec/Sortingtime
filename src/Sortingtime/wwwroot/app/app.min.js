(function(){"use strict";function n(n){var i=this,t;i.onUsersTabSelect=function(){n.$broadcast("configController.onUsersTabSelect",null)};t=function(){};t()}angular.module("app").controller("configController",n);n.$inject=["$rootScope"]})(),function(){"use strict";function n(n,t,i){var r=this,u,f,e,o;r.loading=!1;r.showPasswordDialogToggle=!1;r.disabledChangeParssword=!0;r.activeSaveFullName=function(n,t){u.saveFullName(r.currentUser.fullName,n,function(n){t(n)})};r.showPasswordDialog=function(){r.changePasswordForm.$setPristine();r.currentUser.password="";r.showPasswordDialogToggle=!0};r.cancelPasswordDialog=function(){r.showPasswordDialogToggle=!1};r.savePassword=function(){r.changePasswordForm.password.$setDirty();r.changePasswordForm.$valid&&u.savePassword(r.currentUser.password,function(){r.showPasswordDialogToggle=!1},function(t){var i,u;if(t&&t.data&&angular.isObject(t.data)){i=!1;for(u in t.data)u.toLowerCase().indexOf("password")!=-1&&(i=!0,r.changePasswordForm.password.setServerErrorValidity(!1,t.data[u]));if(i){t.isHandled=!0;return}}n.error(t)})};e=function(){r.loading=!0;r.currentUser=u.getUser(function(){r.loading=!1});r.currentOrganization=f.getOrganization(function(n){r.disabledChangeParssword=n.isDemo})};o=function(){u=i.currentUser.getService();f=i.currentOrganization.getService();e()};o()}angular.module("app").controller("myController",n);n.$inject=["notificationFactory","restService","genericDataFactory","$window"]}(),function(){"use strict";function n(n,t,i,r){var u=this,f,e,o;u.loading=!1;u.cultures=[{label:"ORG.CULTURES.ENGLISH_EU",name:"en-BE"},{label:"ORG.CULTURES.ENGLISH_UK",name:"en-GB"},{label:"ORG.CULTURES.ENGLISH_USA",name:"en-US"},{label:"ORG.CULTURES.DANISH",name:"da-DK"},];u.showLanguageDialogToggle=!1;u.activeSaveName=function(n,t){f.saveName(u.currentOrganization.name,n,function(n){t(n)})};u.activeSaveAddress=function(n,t){f.saveAddress(u.currentOrganization.address,n,function(n){t(n)})};u.activeSaveFirstInvoiceNumber=function(n,t){f.saveFirstInvoiceNumber(u.currentOrganization.firstInvoiceNumber,n,function(n){t(n)})};u.showCultureDialog=function(){u.showCultureDialogToggle=!0};u.cancelCultureDialog=function(){u.showCultureDialogToggle=!1};u.saveCulture=function(){u.currentOrganization.culture||(u.currentOrganization.culture="auto");u.changeCultureForm.$valid&&f.saveCulture(u.currentOrganization.culture,function(){u.showCultureDialogToggle=!1;r.location.reload()})};e=function(){u.loading=!0;u.currentOrganization=f.getOrganization(function(){u.loading=!1})};o=function(){f=i.currentOrganization.getService();e()};o()}angular.module("app").controller("orgController",n);n.$inject=["notificationFactory","restService","genericDataFactory","$window"]}(),function(){"use strict";function n(n,t,i,r){var u=this,f,e,o;u.loading=!1;u.showCreateUserDialogToggle=!1;u.disabledAddUser=!0;r.$on("configController.onUsersTabSelect",function(){u.currentUser&&u.users||(s(),h())});u.showCreateUserDialog=function(){u.createUserForm.$setPristine();u.newUser&&(u.newUser.fullName="",u.newUser.email="");u.showCreateUserDialogToggle=!0};u.cancelCreateUserDialog=function(){u.showCreateUserDialogToggle=!1};u.createUser=function(){u.createUserForm.fullName.$setDirty();u.createUserForm.email.$setDirty();u.createUserForm.$valid&&f.save(u.newUser,function(n){u.users.push(n);u.disabledAddUser=!(!u.currentOrganization.isDemo&&u.users.length<5);u.showCreateUserDialogToggle=!1},function(t){var r,i;if(t&&t.data&&angular.isObject(t.data)){r=!1;for(i in t.data)i.toLowerCase().indexOf("fullName")!=-1?(r=!0,u.createUserForm.fullName.setServerErrorValidity(!1,t.data[i])):i.toLowerCase().indexOf("email")!=-1&&(r=!0,u.createUserForm.email.setServerErrorValidity(!1,t.data[i]));if(r){t.isHandled=!0;return}}n.error(t)})};var s=function(){u.loading=!0;u.currentUser=e.getUser(function(){u.loading=!1});u.currentOrganization=o.getOrganization(function(){})},h=function(){u.users=f.query(function(n){for(var t in n)u.currentUser.id==n[t].id&&(n[t].you=!0);u.disabledAddUser=!(!u.currentOrganization.isDemo&&n.length<5);u.loading=!1},function(t){n.error(t)})},c=function(){e=i.currentUser.getService();o=i.currentOrganization.getService();f=t.getService("./api/user")};c()}angular.module("app").controller("userController",n);n.$inject=["notificationFactory","restService","genericDataFactory","$scope","$window"]}(),function(){"use strict";function n(n,t,i,r,u){var f=this,o,s,v,l,y,e,c;f.loading=!1;f.emptySorting=!1;f.showGroupTaskTotals=!1;f.sortingTabAvtive=!0;f.showCreateInvoiceDialogToggle=!1;f.showDetailInvoiceDialogToggle=!1;f.dateCursor={};f.updateDateCursor=function(n){p();n()};f.toggleSelectGroup=function(n,t){var h,i,r,o,s,u,c,e,l;for(n.stopPropagation(),n.preventDefault(),h=t.group,i=!t.selected,t.selected=i,s=f.sorting.groupTasks,u=0,c=s.length;u<c;u++)if(r=s[u],r.group==h)for(r.selected=i,o=r.users,e=0,l=o.length;e<l;e++)f.toggleSelectUser(n,o[e],null,i)};f.toggleSelectTask=function(n,t){var i,o,s,r,h,u,c;n!==null&&(n.stopPropagation(),n.preventDefault());var l=t.group,a=t.task,e=!t.selected;for(t.selected=e,s=f.sorting.groupTasks,r=0,h=s.length;r<h;r++)if(i=s[r],i.group==l&&i.task==a)for(i.selected=e,o=i.users,u=0,c=o.length;u<c;u++)f.toggleSelectUser(n,o[u],null,e)};f.toggleSelectUser=function(n,t,i,r){var u,h,o,s,e,c;if(n!==null&&(n.stopPropagation(),n.preventDefault()),u=r!==undefined?r:!t.selected,t.selected!==u&&(t.price&&(f.sorting.selectedTotalPrice=f.sorting.selectedTotalPrice+(u?t.price:t.price*-1)),f.sorting.selectedUsers=f.sorting.selectedUsers+(u?1:-1)),t.selected=u,i)if(u){for(o=i.users,s=!0,e=0,c=o.length;e<c;e++)if(h=o[e],!h.selected){s=!1;break}i.selected=s}else i.selected=u};f.noSelectUser=function(n){n!==null&&(n.stopPropagation(),n.preventDefault())};f.activeSaveUserHourPrice=function(t,i,r){v.save({groupReferenceKey:r.groupTask.group,taskReferenceKey:r.groupTask.task,userId:r.user.id,hourPrice:r.user.hourPrice},function(){var e=r.user.price?r.user.price:0,t,o,n,i,s,u,h;if(r.user.price=r.user.hourPrice*r.user.time/60,t=r.user.price-e,r.groupTask.price=(r.groupTask.price?r.groupTask.price:0)+t,f.sorting.totalPrice=(f.sorting.totalPrice?f.sorting.totalPrice:0)+t,r.user.selected&&(f.sorting.selectedTotalPrice=(f.sorting.selectedTotalPrice?f.sorting.selectedTotalPrice:0)+t),r.user.hourPrice)for(i=0,s=f.sorting.groupTasks.length;i<s;i++)for(o=f.sorting.groupTasks[i],u=0,h=o.users.length;u<h;u++)n=o.users[u],n.id==r.user.id&&n.hourPrice===null&&(n.hourPrice=r.user.hourPrice,e=n.price,n.price=n.hourPrice*n.time/60,t=n.price-e,f.sorting.totalPrice=f.sorting.totalPrice+t,f.sorting.selectedTotalPrice=f.sorting.selectedTotalPrice+t)},function(t){var i,u;if(t&&t.data&&angular.isObject(t.data)){i=!1;for(u in t.data)u.toLowerCase().indexOf("hourPrice")!==-1&&(i=!0,r.form.hourPrice.setServerErrorValidity(!1,t.data[u]));if(i){t.isHandled=!0;return}}n.error(t)})};f.showCreateInvoiceDialog=function(){f.emptySorting||(f.createInvoiceForm.$setPristine(),f.createInvoiceTabAvtive=0,k(),f.invoiceDate=f.dateCursor.to,nt(),it(),g(),f.showCreateInvoiceDialogToggle=!0)};f.cancelCreateInvoiceDialog=function(){f.showCreateInvoiceDialogToggle=!1};f.createInvoice=function(){if(f.createInvoiceForm.sendToEmail.$setDirty(),f.createInvoiceForm.emailSubject.$setDirty(),f.createInvoiceForm.emailBody.$setDirty(),f.createInvoiceForm.invoiceTitle.$setDirty(),f.createInvoiceForm.invoiceCustomer.$setDirty(),f.createInvoiceForm.invoicePaymentDetails.$setDirty(),f.createInvoiceForm.invoicePaymentTerms.$setDirty(),f.createInvoiceForm.invoiceDate.$setDirty(),f.createInvoiceForm.invoiceReference.$setDirty(),f.createInvoiceForm.invoiceText.$setDirty(),f.currentOrganization.tax&&(f.createInvoiceForm.invoiceTaxPercentage1.$setDirty(),f.createInvoiceForm.invoiceTaxPercentage2.$setDirty()),f.currentOrganization.vat&&(f.createInvoiceForm.invoiceVatNumber.$setDirty(),f.createInvoiceForm.invoiceVatPercentage1.$setDirty(),f.createInvoiceForm.invoiceVatPercentage2.$setDirty()),f.createInvoiceForm.$valid){var t=a(!0);o.save(t,function(n){tt();d();f.invoiceItems.push(n);f.invoiceItems.subTotalPrice+=n.subTotalPrice;f.showCreateInvoiceDialogToggle=!1},function(t){var i;if(t&&t.data&&angular.isObject(t.data)){var r=!1,e=!1,u=!1;for(i in t.data)i.toLowerCase().indexOf("toemail")!=-1?(r=!0,e=!0,f.createInvoiceForm.sendToEmail.setServerErrorValidity(!1,t.data[i])):i.toLowerCase().indexOf("emailsubject")!=-1?(r=!0,e=!0,f.createInvoiceForm.emailSubject.setServerErrorValidity(!1,t.data[i])):i.toLowerCase().indexOf("emailbody")!=-1?(r=!0,e=!0,f.createInvoiceForm.emailBody.setServerErrorValidity(!1,t.data[i])):i.toLowerCase().indexOf("invoicetitle")!=-1?(r=!0,u=!0,f.createInvoiceForm.invoiceTitle.setServerErrorValidity(!1,t.data[i])):i.toLowerCase().indexOf("invoicecustomer")!=-1?(r=!0,u=!0,f.createInvoiceForm.invoiceCustomer.setServerErrorValidity(!1,t.data[i])):i.toLowerCase().indexOf("vatnumber")!=-1?(r=!0,u=!0,f.createInvoiceForm.invoiceVatNumber.setServerErrorValidity(!1,t.data[i])):i.toLowerCase().indexOf("paymentdetails")!=-1?(r=!0,u=!0,f.createInvoiceForm.invoicePaymentDetails.setServerErrorValidity(!1,t.data[i])):i.toLowerCase().indexOf("invoiceraymentterms")!=-1?(r=!0,u=!0,f.createInvoiceForm.invoicePaymentTerms.setServerErrorValidity(!1,t.data[i])):i.toLowerCase().indexOf("invoicedate")!=-1?(r=!0,f.createInvoiceTabAvtive=1,f.createInvoiceForm.invoiceDate.setServerErrorValidity(!1,t.data[i])):i.toLowerCase().indexOf("invoicereference")!=-1?(r=!0,u=!0,f.createInvoiceForm.invoiceReference.setServerErrorValidity(!1,t.data[i])):i.toLowerCase().indexOf("invoicetext")!=-1?(r=!0,u=!0,f.createInvoiceForm.invoiceText.setServerErrorValidity(!1,t.data[i])):i.toLowerCase().indexOf("taxpercentage")!=-1?(r=!0,u=!0,f.createInvoiceForm.invoiceTaxPercentage1.setServerErrorValidity(!1,t.data[i]),f.createInvoiceForm.invoiceTaxPercentage2.setServerErrorValidity(!1,t.data[i])):i.toLowerCase().indexOf("vatpercentage")!=-1&&(r=!0,u=!0,f.createInvoiceForm.invoiceVatPercentage1.setServerErrorValidity(!1,t.data[i]),f.createInvoiceForm.invoiceVatPercentage2.setServerErrorValidity(!1,t.data[i]));if(r){t.isHandled=!0;e?f.createInvoiceTabAvtive=0:u&&(f.createInvoiceTabAvtive=1);return}}n.error(t)})}else f.createInvoiceTabAvtive=f.createInvoiceForm.sendToEmail.$invalid||f.createInvoiceForm.emailSubject.$invalid||f.createInvoiceForm.emailBody.$invalid?0:f.currentOrganization.tax&&(f.createInvoiceForm.invoiceTaxPercentage1.$invalid||f.createInvoiceForm.invoiceTaxPercentage2.$invalid)||f.currentOrganization.vat&&(f.createInvoiceForm.invoiceVatPercentage1.$invalid||f.createInvoiceForm.invoiceVatPercentage2.$invalid)||f.createInvoiceForm.invoiceDate.$invalid?1:0};f.activeSaveOrganizationName=function(n,t){e.saveName(f.currentOrganization.name,n,function(n){t(n)})};f.activeSaveOrganizationAddress=function(n,t){e.saveAddress(f.currentOrganization.address,n,function(n){t(n)})};f.activeSaveOrganizationVatNumber=function(n,t){e.saveVatNumber(f.currentOrganization.vatNumber,n,function(n){t(n)})};f.activeSaveOrganizationPaymentDetails=function(n,t){e.savePaymentDetails(f.currentOrganization.paymentDetails,n,function(n){t(n)})};f.activeSaveOrganizationTaxPercentage=function(n,t){e.saveTaxPercentage(f.currentOrganization.taxPercentage,function(t){h(!0,!1);n(t)},function(n){t(n)})};f.activeSaveOrganizationVatPercentage=function(n,t){e.saveVatPercentage(f.currentOrganization.vatPercentage,function(t){h(!1,!0);n(t)},function(n){t(n)})};f.createInvoicePriceUpdate=function(n,t,i){var r,u;t.$valid&&(r=i.price?i.price:0,i.price=i.time/60*i.hourPrice,u=i.price-r,f.sorting.selected.subTotalPrice=f.sorting.selected.subTotalPrice+u,h(!0,!0))};f.showInvoiceItemMenu=function(n,t,i){n.preventDefault();n.stopPropagation();i.creditNote!==!0&&(f.invoiceItemSelected&&(f.invoiceItemSelected.selected=!1,f.invoiceItemSelected.selectedPopup=!1),i.selected=!0,i.index=t,f.invoiceItemSelected=i,$(n.target).append($("#invoiceItemMenu")),f.invoiceItemMenuIsOpen=!0)};c=function(){f.invoiceItemMenuIsOpen=!1;$("#invoiceItemMenuContainder").append($("#invoiceItemMenu"))};f.showDetailInvoiceDialog=function(t){t.preventDefault();t.stopPropagation();f.invoiceItemSelected.selectedPopup=!0;c();f.detailInvoiceForm.$setPristine();f.invoiceId=f.invoiceItemSelected.id;s.get({id:f.invoiceItemSelected.id},function(n){f.invoiceNumber=n.number;f.invoiceSubTotalPrice=n.subTotalPrice;f.invoiceSentToEmail=n.toEmail;f.invoiceEmailSubject=n.emailSubject;f.invoiceEmailBody=n.emailBody;f.invoiceCreditNote=n.creditNote;f.showDetailInvoiceDialogToggle=!0;f.loading=!1},function(t){n.error(t)})};f.cancelDetailInvoiceDialog=function(){f.invoiceItemSelected.selectedPopup=!1;f.showDetailInvoiceDialogToggle=!1};f.resendDetailInvoice=function(){if(f.detailInvoiceForm.sendToEmail.$setDirty(),f.detailInvoiceForm.emailSubject.$setDirty(),f.detailInvoiceForm.emailBody.$setDirty(),f.detailInvoiceForm.$valid){var t=a(!1);t.relatedId=f.invoiceId;t.invoice={subTotalPrice:f.invoiceSubTotalPrice};o.save(t,function(n){f.invoiceItemSelected.status=600;f.invoiceItemSelected.toEmail=n.toEmail;f.invoiceItemSelected.selectedPopup=!1;f.showDetailInvoiceDialogToggle=!1},function(t){var r,i;if(t&&t.data&&angular.isObject(t.data)){r=!1;for(i in t.data)i.toLowerCase().indexOf("toemail")!=-1?(r=!0,f.detailInvoiceForm.sendToEmail.setServerErrorValidity(!1,t.data[i])):i.toLowerCase().indexOf("emailsubject")!=-1?(r=!0,f.detailInvoiceForm.emailSubject.setServerErrorValidity(!1,t.data[i])):i.toLowerCase().indexOf("emailbody")!=-1&&(r=!0,f.detailInvoiceForm.emailBody.setServerErrorValidity(!1,t.data[i]));if(r){t.isHandled=!0;return}}n.error(t)})}};f.showCreateCreditNoteDialog=function(t){t.preventDefault();t.stopPropagation();f.creditNoteEmailSubject||u("INVOICE.CREDIT_NOTE_EMAIL_SUBJECT_DFAULTTEXT").then(function(n){f.creditNoteEmailSubject=n});f.creditNoteEmailBody||u("INVOICE.CREDIT_NOTE_EMAIL_BODY_DFAULTTEXT").then(function(n){f.creditNoteEmailBody=n});f.invoiceItemSelected.selectedPopup=!0;c();f.detailInvoiceForm.$setPristine();f.invoiceId=f.invoiceItemSelected.id;s.get({id:f.invoiceItemSelected.id},function(n){f.invoiceNumber=n.number;f.invoiceSubTotalPrice=n.subTotalPrice;f.invoiceSentToEmail=n.toEmail;f.invoiceEmailSubject=n.emailSubject;f.invoiceEmailBody=n.emailBody;f.invoiceCreditNote=!0;f.showDetailInvoiceDialogToggle=!0;f.loading=!1},function(t){n.error(t)})};f.cancelCreateCreditNoteDialog=function(){f.invoiceItemSelected.selectedPopup=!1;f.showDetailInvoiceDialogToggle=!1};f.createCreditNoteInvoice=function(){if(f.detailInvoiceForm.sendToEmail.$setDirty(),f.detailInvoiceForm.emailSubject.$setDirty(),f.detailInvoiceForm.emailBody.$setDirty(),f.detailInvoiceForm.$valid){var t=a(!1,!0);t.relatedId=f.invoiceId;t.invoice={subTotalPrice:f.invoiceSubTotalPrice};t.creditNote=!0;o.save(t,function(n){f.invoiceItems.push(n);f.invoiceItems.subTotalPrice-=n.subTotalPrice;f.invoiceItemSelected.selectedPopup=!1;f.showDetailInvoiceDialogToggle=!1},function(t){var r,i;if(t&&t.data&&angular.isObject(t.data)){r=!1;for(i in t.data)i.toLowerCase().indexOf("toemail")!=-1?(r=!0,f.detailInvoiceForm.sendToEmail.setServerErrorValidity(!1,t.data[i])):i.toLowerCase().indexOf("emailsubject")!=-1?(r=!0,f.detailInvoiceForm.emailSubject.setServerErrorValidity(!1,t.data[i])):i.toLowerCase().indexOf("emailbody")!=-1&&(r=!0,f.detailInvoiceForm.emailBody.setServerErrorValidity(!1,t.data[i]));if(r){t.isHandled=!0;return}}n.error(t)})}};f.showDeleteInvoiceDialog=function(n){n.preventDefault();n.stopPropagation();f.invoiceItemSelected.selectedPopup=!0;c();f.invoiceNumber=f.invoiceItemSelected.number;f.showDeleteInvoiceDialogToggle=!0};f.sendDeleteInvoice=function(){s.delete({id:f.invoiceItemSelected.id},function(){f.invoiceItems.subTotalPrice-=f.invoiceItemSelected.subTotalPrice;f.invoiceItems.splice(f.invoiceItemSelected.index,1);f.invoiceItemSelected.selectedPopup=!1;f.showDeleteInvoiceDialogToggle=!1},function(t){n.error(t)})};f.cancelDeleteInvoiceDialog=function(){f.invoiceItemSelected.selectedPopup=!1;f.showDeleteInvoiceDialogToggle=!1};var p=function(){f.emptyReport=!0;f.sorting=null;setTimeout(function(){w()},0);setTimeout(function(){b()},0)},w=function(){f.loading=!0;o.get({fromDate:f.dateCursor.from.toServerDateString(),toDate:f.dateCursor.to.toServerDateString()},function(n){f.sorting=n;f.sorting.selectedTotalPrice=0;f.sorting.selectedUsers=0;f.emptySorting=f.sorting.groupTasks&&f.sorting.groupTasks.length?!1:!0;f.loading=!1},function(t){n.error(t)})},b=function(){f.loading=!0;s.query({fromDate:f.dateCursor.from.toServerDateString(),toDate:f.dateCursor.to.toServerDateString()},function(n){var t,i,u,r,e;for(f.invoiceItems=n,t=0,u=f.invoiceItems,r=0,e=u.length;r<e;r++)i=u[r],i.creditNote!==!0?t+=i.subTotalPrice:t-=i.subTotalPrice;f.invoiceItems.subTotalPrice=t;f.loading=!1},function(t){n.error(t)})},a=function(n,t){var i={toEmail:f.invoiceSentToEmail,emailSubject:t!==!0?f.invoiceEmailSubject:f.creditNoteEmailSubject,emailBody:t!==!0?f.invoiceEmailBody:f.creditNoteEmailBody},r,e,c,s,h,u,l,o,a;if(n)for(i.showGroupColl=f.showGroupCollInvoiceDialog,i.invoiceTitle=f.invoiceTitle,i.invoiceCustomer=f.invoiceCustomer,i.paymentDetails=f.currentOrganization.paymentDetails,i.invoicePaymentTerms=f.invoicePaymentTerms,i.invoiceDate=f.invoiceDate.toServerDateString(),i.invoiceReference=f.invoiceReference,i.invoiceText=f.invoiceText,i.tax=f.currentOrganization.tax,i.vat=f.currentOrganization.vat,f.currentOrganization.tax&&(i.taxPercentage=f.currentOrganization.taxPercentage,i.taxPrice=f.sorting.selected.taxPrice),f.currentOrganization.vat&&(i.vatNumber=f.currentOrganization.vatNumber,i.vatPercentage=f.currentOrganization.vatPercentage,i.vatPrice=f.sorting.selected.vatPrice),i.totalPrice=f.sorting.selected.totalPrice,i.invoice={subTotalPrice:f.sorting.selected.subTotalPrice,groupTasks:[]},e=f.sorting.selected.groupTasks,c=i.invoice.groupTasks,u=0,l=e.length;u<l;u++)for(r=$.extend(!1,{},e[u]),r.users=[],r.usersSelected=undefined,r.selected=undefined,c.push(r),h=e[u].usersSelected,o=0,a=h.length;o<a;o++)s=$.extend(!1,{},h[o]),s.selected=undefined,r.users.push(s);return i},k=function(){f.sorting.selectedUsers||f.sorting.groupTasks&&f.sorting.groupTasks.length>0&&f.toggleSelectTask(null,f.sorting.groupTasks[0])},d=function(){for(var n,e,t,i,u=f.sorting.groupTasks,r=0,o=u.length;r<o;r++)for(t=u[r],t.selected=!1,i=t.users,n=0,e=i.length;n<e;n++)i[n].selected=!1;f.sorting.selectedTotalPrice=0;f.sorting.selectedUsers=0},h=function(n,t){var i=f.sorting.selected,r,u;i&&(n&&(f.currentOrganization.tax?(r=(f.currentOrganization.taxPercentage?f.currentOrganization.taxPercentage:0)/100,i.taxPrice=(i.subTotalPrice?i.subTotalPrice:0)*r):i.taxPrice=0),t&&(f.currentOrganization.vat?(u=(f.currentOrganization.vatPercentage?f.currentOrganization.vatPercentage:0)/100,i.vatPrice=(i.subTotalPrice?i.subTotalPrice:0)*u):i.vatPrice=0),i.totalPrice=(i.subTotalPrice?i.subTotalPrice:0)+i.taxPrice+i.vatPrice)},g=function(){var i,l,r,a;f.sorting.selected={groupTasks:[]};var u=0,v=f.sorting.selected.groupTasks,e,o,c=f.sorting.groupTasks,n,s,t=[];for(i=0,l=c.length;i<l;i++){for(e=c[i],s=e.users,t=[],r=0,a=s.length;r<a;r++)n=s[r],n.selected&&(t.push($.extend(!1,{},n)),u=u+(n.price?n.price:0));t.length>0&&(o=$.extend(!1,{},e),o.usersSelected=t,v.push(o))}f.sorting.selected.subTotalPrice=u;h(!0,!0)},nt=function(){var i,u,r,t,e,n;for(f.showGroupCollInvoiceDialog=!1,f.firstTask=null,f.firstSelectedGroup=null,f.firstSelectedTask=null,i=!1,r=f.sorting.groupTasks,t=0,e=r.length;t<e;t++)if(n=r[t],f.firstTask||(f.firstTask=n.task),n.selected)if(!f.firstSelectedGroup&&n.group&&(f.firstSelectedGroup=n.group),f.firstSelectedTask||n.group||(f.firstSelectedTask=n.task),i){if(n.group!=u){f.showGroupCollInvoiceDialog=!0;break}}else i=!0,u=n.group;f.firstSelectedGroup||f.firstSelectedTask||(f.firstSelectedTask=f.firstTask)},tt=function(){var t=f.firstSelectedGroup?"group":"task",i=f.firstSelectedGroup?f.firstSelectedGroup:f.firstSelectedTask;l.save({referenceType:t,referenceKey:i,toEmail:f.invoiceSentToEmail,emailSubject:f.invoiceEmailSubject,emailBody:f.invoiceEmailBody,invoiceTitle:f.invoiceTitle,invoiceCustomer:f.invoiceCustomer,invoicePaymentTerms:f.invoicePaymentTerms,invoiceReference:f.invoiceReference,invoiceText:f.invoiceText},function(){},function(t){n.error(t)})},it=function(){var t=f.firstSelectedGroup?"group":"task",i=f.firstSelectedGroup?f.firstSelectedGroup:f.firstSelectedTask;l.get({referenceType:t,referenceKey:i},function(n){rt(n)},function(t){n.error(t)})},rt=function(n){f.invoiceSentToEmail=n.toEmail;f.invoiceEmailSubject=n.emailSubject;f.invoiceEmailBody=n.emailBody;f.invoiceTitle=n.invoiceTitle;f.invoiceCustomer=n.invoiceCustomer;f.invoicePaymentTerms=n.invoicePaymentTerms;f.invoiceReference=n.invoiceReference;f.invoiceText=n.invoiceText;f.invoiceEmailSubject||u("INVOICE.EMAIL_SUBJECT_DFAULTTEXT").then(function(n){f.invoiceEmailSubject=n});f.invoiceEmailBody||u("INVOICE.EMAIL_BODY_DFAULTTEXT").then(function(n){f.invoiceEmailBody=n});f.invoiceTitle||u("INVOICE.INVOICE_TITLE_DFAULTTEXT").then(function(n){f.invoiceTitle=n});f.invoicePaymentTerms||u("INVOICE.PAYMENT_TERMS_DFAULTTEXT").then(function(n){f.invoicePaymentTerms=n});h(!0,!0)},ut=function(){f.currentUser=y.getUser();f.currentOrganization=e.getOrganization(function(){f.currentOrganization.userCount>1&&(f.showGroupTaskTotals=!0)})},ft=function(){var n=(new Date).toDateOnlyFirstDayInMonth();f.dateCursor={from:n,to:n.toDateOnlyLastDayInMonth()};o=t.getService("./api/invoicing");s=t.getService("./api/invoiceItem");v=t.getService("./api/HourPriceSetting");l=t.getService("./api/invoiceSetting");y=i.currentUser.getService();e=i.currentOrganization.getService();ut();p()};ft()}angular.module("app").controller("invoicingController",n);n.$inject=["notificationFactory","restService","genericDataFactory","$filter","$translate","$scope"]}(),function(){"use strict";function n(n,t,i,r,u){var f=this,e,o,c,a,s,h,l;f.loading=!1;f.emptyReport=!1;f.reportTabAvtive=!0;f.showCreateReportDialogToggle=!1;f.showDetailReportDialogToggle=!1;f.dateCursor={};f.updateDateCursor=function(n){v();n()};f.toggleSelectUser=function(n,t){var r,i,u;for(n.stopPropagation(),n.preventDefault(),t.selected=!t.selected,r=t.groupTasks,i=0,u=r.length;i<u;i++)f.toggleSelectTask(n,r[i],t.selected)};f.toggleSelectTotalGroup=function(n,t){var e,r,i,u;for(n.stopPropagation(),n.preventDefault(),e=t.group,t.selected=!t.selected,i=0,u=f.reportsFlattened.length;i<u;i++)r=f.reportsFlattened[i],r.type=="groupTask"&&r.group==e&&(r.selected=t.selected);for(i=0,u=f.report.groupTaskTotals.length;i<u;i++)r=f.report.groupTaskTotals[i],r.group==e&&(r.selected=t.selected)};f.toggleSelectTotalTask=function(n,t){var u,e,i,r,o;for(n!=null&&(n.stopPropagation(),n.preventDefault()),u=t.group,e=t.task,t.selected=!t.selected,r=0,o=f.reportsFlattened.length;r<o;r++)i=f.reportsFlattened[r],i.type=="groupTask"&&i.group==u&&i.task==e&&(i.selected=t.selected)};f.toggleSelectGroup=function(n,t){var r,i,f,u,e;for(n.stopPropagation(),n.preventDefault(),r=!t.selected,t.selected=r,h(t),f=t.group,u=0,e=t.user.groupTasks.length;u<e;u++)i=t.user.groupTasks[u],i.type=="groupTask"&&i.group==f&&i.selected!=r&&(i.selected=r,h(i))};f.toggleSelectTask=function(n,t,i){n.stopPropagation();n.preventDefault();t.selected=i!==undefined?i:!t.selected;h(t)};h=function(n){var e=n.group,o=n.task,u=n.selected,t,s=!0,i,r;if(u)for(i=0,r=f.reportsFlattened.length;i<r;i++)if(t=f.reportsFlattened[i],t.type=="groupTask"&&t.group==e&&t.task==o&&t.selected!=u){s=!1;break}if(s)for(i=0,r=f.report.groupTaskTotals.length;i<r;i++)t=f.report.groupTaskTotals[i],t.group==e&&t.task==o&&(t.selected=u)};f.showCreateReportDialog=function(){f.emptyReport||f.reportsFlattened==null||f.reportsFlattened.length==0||(f.createReportForm.$setPristine(),f.CreateReportTabAvtive=0,it(),ut(),nt(),w(),et(),f.showCreateReportDialogToggle=!0)};f.cancelCreateReportDialog=function(){f.showCreateReportDialogToggle=!1};f.createReport=function(){if(f.createReportForm.sendToEmail.$setDirty(),f.createReportForm.emailSubject.$setDirty(),f.createReportForm.emailBody.$setDirty(),f.createReportForm.reportTitle.$setDirty(),f.createReportForm.reportSubTitle.$setDirty(),f.createReportForm.reportText.$setDirty(),f.createReportForm.$valid){var t=y(!0);e.save(t,function(n){ft();rt();f.reportItems.push(n);f.reportItems.totalTime+=n.totalTime;f.showCreateReportDialogToggle=!1},function(t){var r,i;if(t&&t.data&&angular.isObject(t.data)){r=!1;for(i in t.data)i.toLowerCase().indexOf("toemail")!=-1?(r=!0,f.createReportForm.sendToEmail.setServerErrorValidity(!1,t.data[i])):i.toLowerCase().indexOf("emailsubject")!=-1?(r=!0,f.createReportForm.emailSubject.setServerErrorValidity(!1,t.data[i])):i.toLowerCase().indexOf("emailbody")!=-1?(r=!0,f.createReportForm.emailBody.setServerErrorValidity(!1,t.data[i])):i.toLowerCase().indexOf("reporttitle")!=-1?(r=!0,f.createReportForm.reportTitle.setServerErrorValidity(!1,t.data[i])):i.toLowerCase().indexOf("reportsubtitle")!=-1?(r=!0,f.createReportForm.reportSubTitle.setServerErrorValidity(!1,t.data[i])):i.toLowerCase().indexOf("reporttext")!=-1&&(r=!0,f.createReportForm.reportText.setServerErrorValidity(!1,t.data[i]));if(r){t.isHandled=!0;return}}n.error(t)})}else f.CreateReportTabAvtive=0};f.activeSaveOrganizationName=function(n,t){s.saveName(f.currentOrganization.name,n,function(n){t(n)})};f.activeSaveOrganizationAddress=function(n,t){s.saveAddress(f.currentOrganization.address,n,function(n){t(n)})};f.showReportItemMenu=function(n,t,i){n.preventDefault();n.stopPropagation();f.reportItemSelected&&(f.reportItemSelected.selected=!1,f.reportItemSelected.selectedPopup=!1);i.selected=!0;i.index=t;f.reportItemSelected=i;$(n.target).append($("#reportItemMenu"));f.reportItemMenuIsOpen=!0};l=function(){f.reportItemMenuIsOpen=!1;$("#reportItemMenuContainder").append($("#reportItemMenu"))};f.showDetailReportItem=function(t){t.preventDefault();t.stopPropagation();f.detailReportForm.$setPristine();w();f.reportItemSelected.selectedPopup=!0;l();f.reportId=f.reportItemSelected.id;o.get({id:f.reportItemSelected.id},function(n){f.reportNumber=n.number;f.reportTotalTime=n.totalTime;f.reportSentToEmail=n.toEmail;f.reportEmailSubject=n.emailSubject;f.reportEmailBody=n.emailBody;f.showDetailReportDialogToggle=!0;f.loading=!1},function(t){n.error(t)})};f.cancelDetailReportDialog=function(){f.reportItemSelected.selectedPopup=!1;f.showDetailReportDialogToggle=!1};f.resendDetailReport=function(){if(f.detailReportForm.sendToEmail.$setDirty(),f.detailReportForm.emailSubject.$setDirty(),f.detailReportForm.emailBody.$setDirty(),f.detailReportForm.$valid){var t=y(!1);t.relatedId=f.reportId;t.report={monthTotal:f.reportTotalTime};e.save(t,function(n){f.reportItemSelected.status=600;f.reportItemSelected.toEmail=n.toEmail;f.reportItemSelected.selectedPopup=!1;f.showDetailReportDialogToggle=!1},function(t){var r,i;if(t&&t.data&&angular.isObject(t.data)){r=!1;for(i in t.data)i.toLowerCase().indexOf("toemail")!=-1?(r=!0,f.detailReportForm.sendToEmail.setServerErrorValidity(!1,t.data[i])):i.toLowerCase().indexOf("emailsubject")!=-1?(r=!0,f.detailReportForm.emailSubject.setServerErrorValidity(!1,t.data[i])):i.toLowerCase().indexOf("emailbody")!=-1&&(r=!0,f.detailReportForm.emailBody.setServerErrorValidity(!1,t.data[i]));if(r){t.isHandled=!0;return}}n.error(t)})}};f.showDeleteReportDialog=function(n){n.preventDefault();n.stopPropagation();f.reportItemSelected.selectedPopup=!0;l();f.reportNumber=f.reportItemSelected.number;f.showDeleteReportDialogToggle=!0};f.sendDeleteReport=function(){o.delete({id:f.reportItemSelected.id},function(){f.reportItems.totalTime-=f.reportItemSelected.totalTime;f.reportItems.splice(f.reportItemSelected.index,1);f.reportItemSelected.selectedPopup=!1;f.showDeleteReportDialogToggle=!1},function(t){n.error(t)})};f.cancelDeleteReportDialog=function(){f.reportItemSelected.selectedPopup=!1;f.showDeleteReportDialogToggle=!1};var v=function(){setTimeout(function(){b()},0);setTimeout(function(){k()},0)},b=function(){f.loading=!0;e.get({fromDate:f.dateCursor.from.toServerDateString(),toDate:f.dateCursor.to.toServerDateString()},function(n){f.report=n;d();f.daysInMonth=f.report.daysInMonth;f.loading=!1},function(t){n.error(t)})},k=function(){f.loading=!0;o.query({fromDate:f.dateCursor.from.toServerDateString(),toDate:f.dateCursor.to.toServerDateString()},function(n){var i,u,r,t,e;for(f.reportItems=n,i=0,r=f.reportItems,t=0,e=r.length;t<e;t++)u=r[t],i+=u.totalTime;f.reportItems.totalTime=i;f.loading=!1},function(t){n.error(t)})},y=function(n){var t={toEmail:f.reportSentToEmail,emailSubject:f.reportEmailSubject,emailBody:f.reportEmailBody},r,e,u,i,o;if(n){for(t.showGroupColl=f.showGroupCollRaportDialog,t.reportTitle=f.reportTitle,t.reportSubTitle=f.reportSubTitle,t.reportText=f.reportText,t.report=$.extend(!1,{},f.report),t.report.monthTotal=f.monthTotalSelected,t.report.groupTaskTotals=[],i=0,o=f.groupTaskTotalsSelected.length;i<o;i++)r=f.groupTaskTotalsSelected[i],t.report.groupTaskTotals.push($.extend(!1,{},r));for(t.report.users=[],i=0,o=f.reportsFlattenedSelected.length;i<o;i++)r=f.reportsFlattenedSelected[i],r.type=="user"?(e=$.extend(!1,{},r),e.groupTasks=[],e.type=undefined,e.selected=undefined,t.report.users.push(e)):r.type=="groupTask"&&(u=$.extend(!1,{},r),u.user=undefined,u.type=undefined,u.allWorks=undefined,u.selected=undefined,u.selectNext=undefined,e.groupTasks.push(u))}return t},d=function(){for(var r,s,o=!0,i=[],n,t,u,e=0,h=f.report.users.length;e<h;e++)for(n=f.report.users[e],u&&i.push({type:"space",user:u}),u=n,o=!1,n.type="user",i.push(n),i.push({type:"groupTaskHead",user:n}),r=0,s=n.groupTasks.length;r<s;r++)t=n.groupTasks[r],t.type="groupTask",t.user=n,i.push(t),t.allWorks=g(t);f.emptyReport=o;f.reportsFlattened=i},g=function(n){for(var i,t,e=0,o=[],u=1;u<=f.report.daysInMonth;u++)t=null,i=n.works[e],i&&i.day==u&&(t=i,t.timeView=r("time")(t.time),e++),t||(t={day:u}),o.push(t);return o},nt=function(){var n,o,t,r,i,u,s,e;for(f.reportsFlattenedSelected=[],t=0,r=f.reportsFlattened.length;t<r;t++)n=f.reportsFlattened[t],n.selected?f.reportsFlattenedSelected.push(n):n.selected||n.type!="user"?(n.type=="groupTaskHead"||n.type=="space")&&p(n.user)&&f.reportsFlattenedSelected.push(n):p(n)&&(o=$.extend(!1,{},n),tt(n,o),f.reportsFlattenedSelected.push(o));for(f.monthTotalSelected=0,f.groupTaskTotalsSelected=[],t=0,r=f.reportsFlattenedSelected.length;t<r;t++)if(n=f.reportsFlattenedSelected[t],n.type=="groupTask"){for(i=null,u=0,s=f.groupTaskTotalsSelected.length;u<s;u++)if(e=f.groupTaskTotalsSelected[u],e.group==n.group&&e.task==n.task){i=e;break}i||(i={group:n.group,task:n.task,monthTotal:0},f.groupTaskTotalsSelected.push(i));i.monthTotal+=n.monthTotal;f.monthTotalSelected+=n.monthTotal}},p=function(n){var i,t,r,u;if(n.selected)return!0;for(i=n.groupTasks,t=0,r=i.length;t<r;t++)if(u=i[t],u.selected)return!0;return!1},tt=function(n,t){for(var r,u=0,f=0,e=n.groupTasks,i=0,o=e.length;i<o;i++)r=e[i],r.selected&&(u+=r.monthTotal,f++);t.monthTotal=u;t.selectedCount=f},it=function(){for(var t,i=!1,n=0,r=f.reportsFlattened.length;n<r;n++)t=f.reportsFlattened[n],t.selected&&(i=!0);i||f.report.groupTaskTotals&&f.report.groupTaskTotals.length>0&&f.toggleSelectTotalTask(null,f.report.groupTaskTotals[0])},rt=function(){for(var t,r=f.report.groupTaskTotals,u=f.reportsFlattened,n=0,i=r.length;n<i;n++)r[n].selected=!1;for(n=0,i=u.length;n<i;n++)t=u[n],t.selected&&(t.selected=!1)},ut=function(){var i,r,t,u,n;for(f.firstSelectedGroup=null,f.firstSelectedTask=null,i=!1,t=0,u=f.reportsFlattened.length;t<u;t++)if(n=f.reportsFlattened[t],n.type=="groupTask"&&n.selected)if(!f.firstSelectedGroup&&n.group&&(f.firstSelectedGroup=n.group),f.firstSelectedTask||n.group||(f.firstSelectedTask=n.task),i){if(n.group!=r){f.showGroupCollRaportDialog=!0;return}}else i=!0,r=n.group;f.showGroupCollRaportDialog=!1},ft=function(){var t=f.firstSelectedGroup?"group":"task",i=f.firstSelectedGroup?f.firstSelectedGroup:f.firstSelectedTask;c.save({referenceType:t,referenceKey:i,toEmail:f.reportSentToEmail,emailSubject:f.reportEmailSubject,emailBody:f.reportEmailBody,reportTitle:f.reportTitle,reportText:f.reportText},function(){},function(t){n.error(t)})},et=function(){var t=f.firstSelectedGroup?"group":"task",i=f.firstSelectedGroup?f.firstSelectedGroup:f.firstSelectedTask;c.get({referenceType:t,referenceKey:i},function(n){ot(n)},function(t){n.error(t)})},ot=function(n){f.reportSentToEmail=n.toEmail;f.reportEmailSubject=n.emailSubject;f.reportEmailBody=n.emailBody;f.reportTitle=n.reportTitle;f.reportText=n.reportText;f.reportEmailSubject||u("REPORT.EMAIL_SUBJECT_DFAULTTEXT").then(function(n){f.reportEmailSubject=n});f.reportEmailBody||u("REPORT.EMAIL_BODY_DFAULTTEXT").then(function(n){f.reportEmailBody=n});f.reportTitle||u("REPORT.REPORT_TITLE_DFAULTTEXT").then(function(n){f.reportTitle=n});u("REPORT.REPORT_TITLE_SUB_DFAULTTEXT").then(function(n){f.reportSubTitle=n.replace("<begin_time>",r("date")(f.dateCursor.from,"mediumDate")).replace("<end_time>",r("date")(f.dateCursor.to,"mediumDate"))})},w=function(){f.currentUser=a.getUser();f.currentOrganization=s.getOrganization()},st=function(){var n=(new Date).toDateOnlyFirstDayInMonth();f.dateCursor={from:n,to:n.toDateOnlyLastDayInMonth()};e=t.getService("./api/reporting");o=t.getService("./api/reportItem");c=t.getService("./api/reportSetting");a=i.currentUser.getService();s=i.currentOrganization.getService();v()};st()}angular.module("app").controller("reportingController",n);n.$inject=["notificationFactory","restService","genericDataFactory","$filter","$translate","$scope"]}(),function(){"use strict";function n(n,t){var i=this,h,u,f,e,c,l,a,o=1,v;i.loading=!1;i.dayTotal=0;i.weekTotal=0;i.monthTotal=0;i.showTimerDialogToggle=!1;i.timerData=null;i.pageItems=[];i.currentGroupIds;i.currentTaskIds=[];i.changedUniqIds=[];i.brakes=[{label:"TIME.BRAKE_00MIN",time:0},{label:"TIME.BRAKE_05MIN",time:5},{label:"TIME.BRAKE_10MIN",time:10},{label:"TIME.BRAKE_15MIN",time:15},{label:"TIME.BRAKE_30MIN",time:30},{label:"TIME.BRAKE_45MIN",time:45},{label:"TIME.BRAKE_60MIN",time:60}];i.dateCursor=(new Date).toDateOnly();i.updateDateCursor=function(n){y();n()};i.getGroups=function(t,i,r){l.query({filter:t,eId:b()},function(n){r(n)},function(t){n.error(t)})};i.getTasks=function(t,i,r){a.query({filter:t,groupId:i.groupId,eId:k(i.groupId)},function(n){r(n)},function(t){n.error(t)})};i.activeSaveGroup=function(n,t,r,f,e,o){o==="open"?s(r.item):e===!0?i.removeGroup(r.item):f!==undefined?u.patch({id:f.id},{date:i.dateCursor.toServerDateString(),name:f.value},function(t){r.item.id=f.id;r.item.state=undefined;r.item.name=t.name;i.currentGroupIds=undefined;r.item.tasks=[];i.addTaskButton(r.item);n(t)},function(n){t(n,!0)}):r.item.state!=="n"?u.patch({id:r.item.id},{date:i.dateCursor.toServerDateString(),name:r.item.name},function(t){r.item.name=t.name;n(t)},function(n){t(n)}):(r.form.group.$setDirty(),r.form.$valid&&u.save({date:i.dateCursor.toServerDateString(),name:r.item.name},function(t){r.item.id=t.id;r.item.state=undefined;r.item.name=t.name;i.currentGroupIds=undefined;r.item.tasks=[];i.addTaskButton(r.item);n(t)},function(n){t(n)}))};i.activeSaveTask=function(n,t,r,u,e,o){o==="open"?s(r.item):e===!0?i.removeTask(r.item):u!==undefined?f.patch({id:u.id},{date:i.dateCursor.toServerDateString(),name:u.value},function(t){r.item.id=u.id;r.item.state=undefined;r.item.name=t.name;i.currentTaskIds[r.item.groupId]=undefined;n(t)},function(n){t(n,!0)}):r.item.state!=="n"?f.patch({id:r.item.id},{name:r.item.name},function(t){r.item.name=t.name;n(t)},function(n){t(n)}):(r.form.task.$setDirty(),r.form.$valid&&f.save({date:i.dateCursor.toServerDateString(),name:r.item.name,groupId:r.item.groupId},function(t){r.item.id=t.id;r.item.state=undefined;r.item.name=t.name;i.currentTaskIds[r.item.groupId]=undefined;n(t)},function(n){t(n)}))};v=new Mutex;i.activeSaveTaskItem=function(n,t,u,f,o,h){v.acquire().then(function(f){h==="focus"?(s(u.item),f()):u.item.taskItemId?e.patch({id:u.item.taskItemId},{time:u.item.time?u.item.time:0},function(t){u.item.weekTaskTotal=t.weekTotal;u.item.monthTaskTotal=t.monthTotal;r(u.item,u.item.groupId);r();f();n&&n(t)},function(n){f();t&&t(n)}):(u.form.taskItem.$setDirty(),u.form.$valid?e.save({date:i.dateCursor.toServerDateString(),time:u.item.time,taskId:u.item.id},function(t){u.item.taskItemId=t.id;u.item.weekTaskTotal=t.weekTotal;u.item.monthTaskTotal=t.monthTotal;r(u.item,u.item.groupId);r();f();n&&n(t)},function(n){f();t&&t(n)}):f())})};i.changeItem=function(n,t){n.state=t};i.addGroup=function(n){var r=i.pageItems.indexOf(n),t={};t.uniqId="u"+o++;t.state="n";t.type="g";t.dayTaskTotal=0;t.weekTaskTotal=0;t.monthTaskTotal=0;i.pageItems.splice(r,0,t)};i.addTask=function(n){var r=i.pageItems.indexOf(n),t={};t.groupId=n.groupId;t.uniqId="u"+o++;t.state="n";t.type="t";t.weekTaskTotal=0;t.monthTaskTotal=0;i.pageItems.splice(r,0,t)};i.addTaskButton=function(n){var r=i.pageItems.indexOf(n),t={};t.groupId=n.id;t.uniqId="u"+o++;t.state="b";t.type="t";i.pageItems.splice(r+1,0,t)};i.removeGroup=function(t){t.id?u.remove({id:t.id},{date:i.dateCursor.toServerDateString(),name:t.name},function(){i.currentGroupIds=undefined;r();p(t)},function(t){n.error(t)}):p(t)};i.removeTask=function(t){if(t.id)f.remove({id:t.id},{date:i.dateCursor.toServerDateString(),name:t.name,groupId:t.groupId},function(){i.currentTaskIds[t.groupId]=undefined;r(t,t.groupId);r();var n=i.pageItems.indexOf(t);i.pageItems.splice(n,1)},function(t){n.error(t)});else{var u=i.pageItems.indexOf(t);i.pageItems.splice(u,1)}};i.showTimerDialog=function(n,t){i.timerData={item:n,form:t};i.timerData.item.calcBrakeTime===undefined&&(i.timerData.item.calcBrakeTime=0);i.timerData.item.calcTime===undefined&&(i.timerData.item.calcTime=0);i.timerData.item.time>=0&&(i.timerData.item.calcFromTime===undefined&&(i.timerData.item.calcFromTime=0),i.timerData.item.calcFromTime+i.timerData.item.time>1440&&(i.timerData.item.calcFromTime=0),i.timerData.item.calcToTime=i.timerData.item.calcFromTime+i.timerData.item.time);i.showTimerDialogToggle=!0};i.saveCalcTime=function(){i.activeSaveTaskItem(null,null,i.timerData,null,null,"focus");i.timerData.item.time=i.timerData.item.calcTime;i.activeSaveTaskItem(i.closeCalcTime,i.closeCalcTime,i.timerData)};i.cancelTimerDialog=function(){i.closeCalcTime()};i.closeCalcTime=function(){i.showTimerDialogToggle=!1};i.activeCalcTime=function(){if(i.timerData.item.calcToTime>0){i.timerData.item.calcFromTime===undefined&&(i.timerData.item.calcFromTime=0);var n=Number(i.timerData.item.calcToTime-i.timerData.item.calcFromTime);i.timerData.item.calcBrakeTime>=0&&(n=n-i.timerData.item.calcBrakeTime);n<0&&(n=0);i.timerData.item.calcTime=n}};var w=function(){h=t.getService("./api/dashboard");u=t.getService("./api/dashboardGroup");f=t.getService("./api/dashboardTask");e=t.getService("./api/dashboardTaskItem");c=t.getService("./api/dashboardTotal");l=t.getService("./api/filtergroup");a=t.getService("./api/filtertask");y()},y=function(){i.loading=!0;h.query({date:i.dateCursor.toServerDateString(),cuid:i.changedUniqIds},function(n){i.currentGroupIds=undefined;i.currentTaskIds=[];i.changedUniqIds=[];i.pageItems=n;i.loading=!1},function(t){n.error(t)});r()},r=function(t,r){var e,u,o,f,s;if(t!==undefined)for(e=i.pageItems,o=e.indexOf(t),f=o,s=0;f>=s;f--)if(e[f].type==="g"){u=e[f];break}c.get({date:i.dateCursor.toServerDateString(),groupId:t!==undefined?r:null},function(n){t!==undefined?u!==undefined&&(u.dayTaskTotal=n.dayTotal,u.weekTaskTotal=n.weekTotal,u.monthTaskTotal=n.monthTotal):(i.dayTotal=n.dayTotal,i.weekTotal=n.weekTotal,i.monthTotal=n.monthTotal)},function(t){n.error(t)})},p=function(n){for(var t=i.pageItems,u=1,f=t.indexOf(n),r=f+1,e=t.length;r<e;r++)if(t[r].type==="g")break;else t[r].type==="t"&&u++;t.splice(f,u)},b=function(){var u,n,t,r,f;if(i.pageItems){if(i.currentGroupIds)return i.currentGroupIds;for(u=i.pageItems,t=[],r=0,f=u.length;r<f;r++)n=u[r],n.type==="g"&&n.state===undefined&&t.push(n.id);return i.currentGroupIds=t,t}return i.currentGroupIds=undefined,null},k=function(n){var f,t,r,u,e;if(i.pageItems){if(i.currentTaskIds[n])return i.currentTaskIds[n];for(f=i.pageItems,r=[],u=0,e=f.length;u<e;u++)t=f[u],t.type==="t"&&t.groupId===n&&t.id!==undefined&&r.push(t.id);return i.currentTaskIds[n]=r,r}return i.currentTaskIds=[],null},s=function(n){var t=n.uniqId,r=i.changedUniqIds;r.includes(t)||r.push(t)};w()}angular.module("app").controller("timeController",n);n.$inject=["notificationFactory","restService","$interval","$scope"]}(),function(){"use strict";function n(n,t){return{restrict:"A",require:["ngModel"],scope:{activeSave:"&",activeSaveData:"=",activeSaveModel:"=",activeSaveForm:"=",activeSaveMode:"@",focusEvent:"@",model:"=ngModel"},link:function(i,r,u,f){var e=f[0],y=!1,o=!1,l=!0,v=null,s=null,a=null,h=null,p=null,c=!1;r.bind("focus",function(n){o&&console.log("activeSaveDirective; event focus");i.focusEvent==="true"&&i.activeSave()(null,null,w(),null,null,"focus");i.bindEvents();n.preventDefault();k(!0);c=!1});i.bindModelEvent=function(){i.$watch("model",function(n,t){l&&(o&&console.log("activeSaveDirective; initValueBackup"),b(!0),l=!1);e.setServerErrorValidity(!0);!l&&(c||e.$valid&&e.$dirty)&&(o&&console.log("activeSaveDirective; watch model newVal: "+n+", oldVal: "+t),nt())})};i.activeSaveMode==="instant"&&i.bindModelEvent();i.bindEvents=function(){o&&console.log("activeSaveDirective; bindEvents");y||(y=!0,i.activeSaveMode!=="instant"&&i.bindModelEvent(),r.bind("blur",function(n){o&&console.log("activeSaveDirective; event blur");n.preventDefault();k()}),r.bind("keydown",function(n){n.which===13?(o&&console.log("activeSaveDirective; keydown = 13"),(r.context.tagName!=="TEXTAREA"||n.ctrlKey)&&e.$valid&&(n.preventDefault(),n.stopPropagation(),r.blur())):n.which===27&&(o&&console.log("activeSaveDirective; keydown = 27"),n.preventDefault(),n.stopPropagation(),d(),n.target.blur())}))};e.setServerErrorValidity=function(n,t){e.serverError=n?"":t.join?t.join(", "):t;e.$setValidity("serverError",n)};e.setModalValue=function(n){o&&console.log("activeSaveDirective; setModalValue, ModalValue: "+n);i.model=n;i.$apply()};var w=function(){return i.activeSaveData!==undefined?i.activeSaveData:{item:i.activeSaveModel,form:i.activeSaveForm}},nt=function(){o&&console.log("activeSaveDirective; saveModel");v&&t.cancel(v);v=t(function(){tt()},0)},tt=function(){(c||e.$valid&&e.$dirty)&&(o&&console.log("activeSaveDirective; handleSaveModal do activeSave"),g(p,i.model)||(o&&console.log("activeSaveDirective; handleSaveModal do activeSave, saving"),p=angular.copy(i.model),i.activeSave()(it,rt,w())))},it=function(){o&&console.log("activeSaveDirective; activeSaveSuccessCallBack");b(!1)},rt=function(t){if(o&&console.log("activeSaveDirective; activeSaveErrorCallBack"),t&&t.data&&angular.isObject(t.data))for(var i in t.data){e.setServerErrorValidity(!1,t.data[i]);t.isHandled=!0;break}else n.error(t)},b=function(n){n&&(a=angular.copy(i.model));g(h,i.model)||(h=angular.copy(i.model),o&&console.log("activeSaveDirective; backupModal backupModelValue: "+h))},k=function(n){o&&console.log("activeSaveDirective; rollbackModalOnError, cancel: "+n);n?s&&t.cancel(s):(s&&t.cancel(s),s=t(function(){ut()},4e3))},ut=function(){c||e.$valid||!e.$dirty||(o&&console.log("activeSaveDirective; handleRollbackModalOnError"),d())},d=function(){o&&console.log("activeSaveDirective; roleBackBackupModelValue: "+a+", backupModelValue: "+h);a?(e.setModalValue(a),e.$setDirty()):l&&!c&&(e.$setPristine(),e.setModalValue(h))},g=function(n,t){if(angular.isDate(n)&&angular.isDate(t)){if(n.getTime()==t.getTime())return!0}else if(n==t)return!0;return!1}}}}angular.module("app").directive("activeSave",n);n.$inject=["notificationFactory","$timeout"]}(),function(){"use strict";function n(n){var t='<div ng-form="dateCursorForm" class="date-select"><div class="input-group"><span class="input-group-btn" style="vertical-align: bottom"><button class="btn btn-invisible glyphicon glyphicon-menu-left" type="button" translate-once-title="GENERAL.DATE_SELECT.BACK" ng-click="back()" /><button class="btn btn-invisible glyphicon glyphicon-calendar" type="button" translate-once-title="GENERAL.DATE_SELECT.SELECT" ng-click="toggleDatepicker($event)" /><input type="text" style="position: absolute; bottom: 0px; left: 37px; padding: 0px; margin: 0px; line-height: 0px; height: 0px; width: 0px; visibility: hidden" uib-datepicker-popup show-button-bar="true" datepicker-popup-template-url="ui/template/datepicker/popup.html" current-text="{{\'GENERAL.DATE_SELECT.TODAY\'|translate}}" is-open="openDatepicker" ng-model="hiddenDateModel" /><\/span><strong><input name="dateCursor" type="text" class="form-control text-center strong" active-save="updateDateCursor" active-save-mode="instant" date-format required ng-model="model" /><\/strong><span class="input-group-btn"><button class="btn btn-invisible glyphicon glyphicon-record" type="button" translate-once-title="GENERAL.DATE_SELECT.TODAY" ng-click="today()" /><button class="btn btn-invisible glyphicon glyphicon-menu-right" type="button" translate-once-title="GENERAL.DATE_SELECT.FORWARD" ng-click="forward()" /><\/span><\/div><field-error class="text-center" field="dateCursorForm.dateCursor" /><\/div>';return{restrict:"E",replace:!0,scope:{update:"&",model:"=ngModel"},link:function(i,r){var f,u,e;r.html(t).show();n(r.contents())(i);f=i.dateCursorForm.dateCursor;i.$watch("hiddenDateModel",function(n){e(n,i.model)&&u(n)});i.$watch("model",function(n){e(n,i.hiddenDateModel)&&(i.hiddenDateModel=n)});i.openDatepicker=!1;i.updateDateCursor=function(n,t){i.update()(n,t)};i.back=function(){i.model===null||i.model===undefined?i.today():u(new Date(i.model).addDays(-1))};i.forward=function(){i.model===null||i.model===undefined?i.today():u(new Date(i.model).addDays(1))};i.today=function(){u((new Date).toDateOnly())};i.toggleDatepicker=function(n){n.preventDefault();i.openDatepicker=i.openDatepicker?!1:!0};u=function(n){if(!f.setModalDateAndDirty)throw"Error. Missing the method setModalDateAndDirty. Probably dateFormat directive is required.";i.model!=n&&f.setModalDateAndDirty(n)};e=function(n,t){if(n===undefined||n===null)return!1;if(angular.isDate(n)&&angular.isDate(t)){if(n.getTime()!=t.getTime())return!0}else if(angular.isDate(n)&&!angular.isDate(t))return!0;return!1}}}}angular.module("app").directive("dateDaySelect",n);n.$inject=["$compile"]}(),function(){"use strict";function n(n){var t='<div ng-form="dateCursorForm" class="date-select"><div class="input-group"><span class="input-group-btn" style="vertical-align: bottom"><button ng-show="!dividedScale" class="btn btn-invisible glyphicon glyphicon-menu-left" type="button" translate-once-title="GENERAL.DATE_SELECT.BACK" ng-click="back()" /><button class="btn btn-invisible glyphicon glyphicon-calendar" type="button" translate-once-title="GENERAL.DATE_SELECT.SELECT" ng-click="toggleDatepickerFrom($event)" /><input type="text" style="position: absolute; bottom: 0px; left: 37px; padding: 0px; margin: 0px; line-height: 0px; height: 0px; width: 0px; visibility: hidden" uib-datepicker-popup datepicker-options="{minMode: \'month\', datepickerMode: \'month\'}" show-button-bar="true" datepicker-popup-template-url="ui/template/datepicker/popup.html" current-text="{{\'GENERAL.DATE_SELECT.TODAY\'|translate}}" is-open="openDatepickerFrom" ng-model="hiddenDateModelFrom" /><input type="text" style="position: absolute; bottom: 0px; left: 37px; padding: 0px; margin: 0px; line-height: 0px; height: 0px; width: 0px; visibility: hidden" uib-datepicker-popup show-button-bar="true" datepicker-popup-template-url="ui/template/datepicker/popup.html" current-text="{{\'GENERAL.DATE_SELECT.TODAY\'|translate}}" is-open="openDatepickerFromScale" ng-model="hiddenDateModelFrom" /><\/span><strong><input name="dateCursorFrom" type="text" class="form-control text-center strong" active-save="updateDateCursor" active-save-mode="instant" date-format format="month" required ng-model="model.from" /><\/strong><span ng-show="dividedScale" class="input-group-btn" style="vertical-align: bottom"><span class="input-group-addon">-<\/span><\/span><span ng-show="dividedScale" class="input-group-btn" style="vertical-align: bottom"><button class="btn btn-invisible glyphicon glyphicon-calendar" type="button" translate-once-title="GENERAL.DATE_SELECT.SELECT" ng-click="toggleDatepickerTo($event)" /><input type="text" style="position: absolute; bottom: 0px; left: 37px; padding: 0px; margin: 0px; line-height: 0px; height: 0px; width: 0px; visibility: hidden" uib-datepicker-popup show-button-bar="true" datepicker-popup-template-url="ui/template/datepicker/popup.html" current-text="{{\'GENERAL.DATE_SELECT.TODAY\'|translate}}" is-open="openDatepickerTo" ng-model="hiddenDateModelTo" /><\/span><strong ng-show="dividedScale"><input name="dateCursorTo" type="text" class="form-control text-center strong" active-save="updateDateCursorTo" active-save-mode="instant" date-format required ng-model="model.to" /><\/strong><span class="input-group-btn"><button class="btn btn-invisible glyphicon glyphicon-scale" style="Display: none" type="button" translate-once-title="GENERAL.DATE_SELECT.CHANGE_SCALE" ng-click="changeScale()" /><button class="btn btn-invisible glyphicon glyphicon-record" type="button" translate-once-title="GENERAL.DATE_SELECT.TODAY" ng-click="today()" /><button ng-show="!dividedScale" class="btn btn-invisible glyphicon glyphicon-menu-right" type="button" translate-once-title="GENERAL.DATE_SELECT.FORWARD" ng-click="forward()" /><\/span><\/div><field-error class="text-center" field="dateCursorForm.dateCursorFrom" /><field-error class="text-center" field="dateCursorForm.dateCursorTo" /><\/div>';return{restrict:"E",replace:!0,scope:{update:"&",dividedScale:"=",model:"=ngModel"},link:function(i,r){var f,s;r.html(t).show();n(r.contents())(i);f=i.dateCursorForm.dateCursorFrom;s=i.dateCursorForm.dateCursorTo;i.$watch("hiddenDateModelFrom",function(n){o(n,i.model.from)&&u(n)});i.$watch("hiddenDateModelTo",function(n){o(n,i.model.to)&&e(n)});i.$watch("model.from",function(n){o(n,i.hiddenDateModelFrom)&&(i.hiddenDateModelFrom=n)});i.$watch("model.to",function(n){i.dividedScale&&o(n,i.hiddenDateModelTo)&&(i.hiddenDateModelTo=n)});i.openDatepickerFrom=!1;i.openDatepickerFromScale=!1;i.openDatepickerTo=!1;i.updateDateCursor=function(n,t){i.update()(n,t)};i.updateDateCursorTo=function(n,t){i.update()(n,t)};i.changeScale=function(){var n=!i.dividedScale;n?f.setFormat("day"):(f.setFormat("month"),u(i.model.from.toDateOnlyFirstDayInMonth(),!0));i.dividedScale=n};i.back=function(){i.model.from===null||i.model.from===undefined?i.today():u(new Date(i.model.from.toDateOnlyFirstDayInMonth()).addMonths(-1),!0)};i.forward=function(){i.model.from===null||i.model.from===undefined?i.today():u(new Date(i.model.from.toDateOnlyFirstDayInMonth()).addMonths(1),!0)};i.today=function(){var n=new Date;u(n.toDateOnlyFirstDayInMonth(),!0)};i.toggleDatepickerFrom=function(n){n.preventDefault();i.dividedScale?i.openDatepickerFromScale?i.openDatepickerFromScale=!1:(i.openDatepickerTo=!1,i.openDatepickerFrom=!1,i.openDatepickerFromScale=!0):i.openDatepickerFrom?i.openDatepickerFrom=!1:(i.openDatepickerTo=!1,i.openDatepickerFromScale=!1,i.openDatepickerFrom=!0)};i.toggleDatepickerTo=function(n){n.preventDefault();i.openDatepickerTo?i.openDatepickerTo=!1:(i.openDatepickerFrom=!1,i.openDatepickerFromScale=!1,i.openDatepickerTo=!0)};var u=function(n,t,r){if(!f.setModalDateFromAndDirty)throw"Error. Missing the method setModalDateAndDirty. Probably dateFormat directive is required.";if(i.model.from!=n){if(!r)if(!i.dividedScale||t)e(n.toDateOnlyLastDayInMonth(),!0);else if(n<i.model.to){var u=new Date(n).addDays(30);i.model.to>u&&e(u,!0)}else n>i.model.to?e(new Date(n).addDays(30),!0):e(new Date(n).addDays(1),!0);f.setModalDateFromAndDirty(n,r);i.hiddenDateModelFrom=n}},e=function(n,t){if(!s.setModalDateToAndDirty)throw"Error. Missing the method setModalDateAndDirty. Probably dateFormat directive is required.";if(i.model.to!=n){if(!t&&i.dividedScale)if(n>i.model.from){var r=new Date(n).addDays(-30);i.model.from<r&&u(r,!0)}else n<i.model.from?u(new Date(n).addDays(-30),!0):u(new Date(n).addDays(-1),!0);s.setModalDateToAndDirty(n,t);i.hiddenDateModelTo=n}},o=function(n,t){if(n===undefined||n===null)return!1;if(angular.isDate(n)&&angular.isDate(t)){if(n.getTime()!=t.getTime())return!0}else if(angular.isDate(n)&&!angular.isDate(t))return!0;return!1}}}}angular.module("app").directive("dateMonthSelect",n);n.$inject=["$compile"]}(),function(){"use strict";function n(n){var t='<div ng-form="dateCursorForm" class="date-select"><div class="input-group"><span class="input-group-btn" style="vertical-align: bottom"><button class="btn btn-invisible glyphicon glyphicon-menu-left" type="button" translate-once-title="GENERAL.DATE_SELECT.BACK" ng-click="back()" /><button class="btn btn-invisible glyphicon glyphicon-calendar" type="button" translate-once-title="GENERAL.DATE_SELECT.SELECT" ng-click="toggleDatepicker($event)" /><input type="text" style="position: absolute; bottom: 0px; left: 37px; padding: 0px; margin: 0px; line-height: 0px; height: 0px; width: 0px; visibility: hidden" uib-datepicker-popup show-button-bar="true" datepicker-popup-template-url="ui/template/datepicker/popup.html" current-text="{{\'GENERAL.DATE_SELECT.TODAY\'|translate}}" is-open="openDatepicker" ng-model="hiddenDateModel" /><\/span><strong><input name="dateCursor" type="text" class="form-control text-center strong" active-save="updateDateCursor" active-save-mode="instant" date-format required ng-model="model" /><\/strong><span class="input-group-btn"><button class="btn btn-invisible glyphicon glyphicon-record" type="button" translate-once-title="GENERAL.DATE_SELECT.TODAY" ng-click="today()" /><button class="btn btn-invisible glyphicon glyphicon-menu-right" type="button" translate-once-title="GENERAL.DATE_SELECT.FORWARD" ng-click="forward()" /><\/span><\/div><field-error class="text-center" field="dateCursorForm.dateCursor" /><\/div>',i='<div ng-form="dateCursorForm" class="date-select"><div class="input-group"><span class="input-group-btn" style="vertical-align: bottom"><button class="btn btn-invisible glyphicon glyphicon-menu-left" type="button" translate-once-title="GENERAL.DATE_SELECT.BACK" ng-click="back()" /><button class="btn btn-invisible glyphicon glyphicon-calendar" type="button" translate-once-title="GENERAL.DATE_SELECT.SELECT" ng-click="toggleDatepicker($event)" /><input type="text" style="position: absolute; bottom: 0px; left: 37px; padding: 0px; margin: 0px; line-height: 0px; height: 0px; width: 0px; visibility: hidden" uib-datepicker-popup datepicker-options="{minMode: \'month\', datepickerMode: \'month\'}" show-button-bar="true" datepicker-popup-template-url="ui/template/datepicker/popup.html" current-text="{{\'GENERAL.DATE_SELECT.TODAY\'|translate}}" is-open="openDatepicker" ng-model="hiddenDateModel" /><\/span><strong><input name="dateCursor" type="text" class="form-control text-center strong" active-save="updateDateCursor" active-save-mode="instant" date-format format="month" required ng-model="model" /><\/strong><span class="input-group-btn"><button class="btn btn-invisible glyphicon glyphicon-record" type="button" translate-once-title="GENERAL.DATE_SELECT.TODAY" ng-click="today()" /><button class="btn btn-invisible glyphicon glyphicon-menu-right" type="button" translate-once-title="GENERAL.DATE_SELECT.FORWARD" ng-click="forward()" /><\/span><\/div><field-error class="text-center" field="dateCursorForm.dateCursor" /><\/div>';return{restrict:"E",replace:!0,scope:{update:"&",datepickerMode:"@",model:"=ngModel"},link:function(r,u){var e,f,o;r.datepickerMode=="month"?u.html(i).show():u.html(t).show();n(u.contents())(r);e=r.dateCursorForm.dateCursor;r.$watch("hiddenDateModel",function(n){o(n,r.model)&&f(n)});r.$watch("model",function(n){o(n,r.hiddenDateModel)&&(r.hiddenDateModel=n)});r.openDatepicker=!1;r.updateDateCursor=function(n,t){r.update()(n,t)};r.back=function(){r.model===null||r.model===undefined?r.today():r.datepickerMode=="month"?f(new Date(r.model).addMonths(-1)):f(new Date(r.model).addDays(-1))};r.forward=function(){r.model===null||r.model===undefined?r.today():r.datepickerMode=="month"?f(new Date(r.model).addMonths(1)):f(new Date(r.model).addDays(1))};r.today=function(){r.datepickerMode=="month"?f((new Date).toDateOnlyFirstDayInMonth()):f((new Date).toDateOnly())};r.toggleDatepicker=function(n){n.preventDefault();n.stopPropagation();r.openDatepicker=r.openDatepicker?!1:!0};f=function(n){if(!e.setModalDateAndDirty)throw"Error. Missing the method setModalDateAndDirty. Probably dateFormat directive is required.";r.model!=n&&e.setModalDateAndDirty(n)};o=function(n,t){if(n===undefined||n===null)return!1;if(angular.isDate(n)&&angular.isDate(t)){if(n.getTime()!=t.getTime())return!0}else if(angular.isDate(n)&&!angular.isDate(t))return!0;return!1}}}}angular.module("app").directive("dateSelect",n);n.$inject=["$compile"]}(),function(){"use strict";function n(){return{restrict:"E",require:["ngModel"],transclude:!0,scope:{model:"=ngModel"},template:'<div class="input-group"><input type="text" style="position: absolute; bottom: 0px; left: 0px; padding: 0px; margin: 0px; line-height: 0px; height: 0px; width: 0px; visibility: hidden" uib-datepicker-popup show-button-bar="true" datepicker-popup-template-url="ui/template/datepicker/popup.html" current-text="{{\'GENERAL.DATE_SELECT.TODAY\'|translate}}" is-open="openDatepicker" ng-model="model" /><span ng-transclude><\/span><span class="input-group-btn"><button  style="margin-right: 0px" class="btn btn-invisible glyphicon glyphicon-calendar" type="button" translate-once-title="GENERAL.DATE_SELECT.SELECT" ng-click="toggleDatepicker($event)" /><\/span><\/div>',link:function(n){n.openDatepicker=!1;n.toggleDatepicker=function(t){t.preventDefault();t.stopPropagation();n.openDatepicker=n.openDatepicker?!1:!0}}}}angular.module("app").directive("datepicker",n)}(),function(){"use strict";function n(){return{restrict:"E",replace:!0,scope:{field:"=field"},template:'<div><div class="error-block" ng-messages="field.$error" ng-if="field.$dirty"><div ng-messages-include="error-messages"><\/div><div ng-message="serverError">{{field.serverError}}<\/div><\/div><\/div>'}}angular.module("app").directive("fieldError",n)}(),function(){"use strict";function n(n){return{restrict:"A",link:function(t,i,r){var u=n(r.fileChange),f=function(n){t.$apply(function(){u(t,{$event:n,files:n.target.files})})};i[0].addEventListener("change",f,!1)}}}angular.module("app").directive("fileChange",n);n.$inject=["$parse"]}(),function(){"use strict";function n(n,t){var i=[];i.currentUser=[];i.currentOrganization=[];i.currentLogo=[];i.currentUser.getService=function(){return{getUser:function(n,t){return r(n,t),i.currentUser.user},saveFullName:function(t,r,u){i.currentUser.service.patch({id:i.currentUser.user.id},{fullName:t},function(n){i.currentUser.user.fullName=n.fullName;r&&r(n)},function(t){u?u(t):n.error(t)})},savePassword:function(t,r,u){i.currentUser.service.patch({id:i.currentUser.user.id},{password:t},function(n){r&&r(n)},function(t){u?u(t):n.error(t)})}}};i.currentOrganization.getService=function(){return{getOrganization:function(n,t){return u(n,t),i.currentOrganization.organization},saveName:function(t,r,u){i.currentOrganization.service.patch({id:0},{name:t},function(n){i.currentOrganization.organization.name=n.name;r&&r(n)},function(t){u?u(t):n.error(t)})},saveAddress:function(t,r,u){i.currentOrganization.service.patch({id:0},{address:t},function(n){i.currentOrganization.organization.address=n.address;r&&r(n)},function(t){u?u(t):n.error(t)})},saveVatNumber:function(t,r,u){i.currentOrganization.service.patch({id:0},{vatNumber:t},function(n){i.currentOrganization.organization.vatNumber=n.vatNumber;r&&r(n)},function(t){u?u(t):n.error(t)})},savePaymentDetails:function(t,r,u){i.currentOrganization.service.patch({id:0},{paymentDetails:t},function(n){i.currentOrganization.organization.paymentDetails=n.paymentDetails;r&&r(n)},function(t){u?u(t):n.error(t)})},saveTaxPercentage:function(t,r,u){i.currentOrganization.service.patch({id:0},{taxPercentage:t},function(n){i.currentOrganization.organization.taxPercentage=n.taxPercentage;r&&r(n)},function(t){u?u(t):n.error(t)})},saveVatPercentage:function(t,r,u){i.currentOrganization.service.patch({id:0},{vatPercentage:t},function(n){i.currentOrganization.organization.vatPercentage=n.vatPercentage;r&&r(n)},function(t){u?u(t):n.error(t)})},saveFirstInvoiceNumber:function(t,r,u){i.currentOrganization.service.patch({id:0},{firstInvoiceNumber:t},function(n){i.currentOrganization.organization.firstInvoiceNumber=n.firstInvoiceNumber;r&&r(n)},function(t){u?u(t):n.error(t)})},saveCulture:function(t,r,u){i.currentOrganization.service.patch({id:0},{culture:t},function(n){i.currentOrganization.organization.culture=n.culture;r&&r(n)},function(t){u?u(t):n.error(t)})}}};i.currentLogo.getService=function(){return{getLogo:function(n,t){f(n,t)},saveLogo:function(t,r,u){i.currentLogo.service.save({image:t},function(n){i.currentLogo.logo=n.image;r&&r(i.currentLogo.logo)},function(t){u?u(t):n.error(t)})}}};var r=function(t,r){i.currentUser.user?setTimeout(t,0):i.currentUser.user=i.currentUser.service.get({id:-1},function(n){t&&t(n)},function(t){r?r(t):n.error(t)})},u=function(t,r){i.currentOrganization.organization?setTimeout(t,0):i.currentOrganization.organization=i.currentOrganization.service.get({},function(n){e(i.currentOrganization.organization);t&&t(n)},function(t){r?r(t):n.error(t)})},e=function(n){n.culture=="en-US"?(n.tax=!0,n.vat=!1,n.taxPercentage=n.taxPercentage?n.taxPercentage:0):(n.tax=!1,n.vat=!0,n.vatPercentage=n.vatPercentage?n.vatPercentage:0)},f=function(t,r){i.currentLogo.logo?setTimeout(function(){t&&t(i.currentLogo.logo)},0):i.currentLogo.service.get({},function(n){i.currentLogo.logo=n.image;t&&t(i.currentLogo.logo)},function(t){r?r(t):n.error(t)})},o=function(){i.currentUser.service=t.getService("./api/user");i.currentOrganization.service=t.getService("./api/organization");i.currentLogo.service=t.getService("./api/logo");setTimeout(function(){r();u()},2e3);setTimeout(function(){f()},1e4)};return o(),i}angular.module("app").service("genericDataFactory",n);n.$inject=["notificationFactory","restService"]}(),function(){"use strict";function n(n){return{restrict:"C",require:["ngModel","^?groupTaskDropdown"],scope:{setFocus:"@",model:"=ngModel"},link:function(t,i,r,u){var f=u[0],s=!1,e=u[1],o=!1;i.bind("focus",function(n){o&&console.log("inactiveSaveDirective; event focus");t.bindEvents();e&&(n.stopPropagation(),e.open())});i.bind("click",function(n){o&&console.log("inactiveSaveDirective; event click");e&&n.stopPropagation()});t.bindEvents=function(){o&&console.log("inactiveSaveDirective; bindEvents");s||(s=!0,t.$watch("model",function(){f.setServerErrorValidity(!0)}),i.bind("keydown",function(n){n.which===13?(o&&console.log("inactiveSaveDirective; keydown = 13"),(i.context.tagName!=="TEXTAREA"||n.ctrlKey)&&f.$valid&&(n.preventDefault(),n.stopPropagation(),e&&e.save(),i.blur())):n.which===27&&(o&&console.log("inactiveSaveDirective; keydown = 27"),n.preventDefault(),n.stopPropagation(),e&&e.cancel(),n.target.blur())}))};f.setServerErrorValidity=function(n,t){f.serverError=n?"":t.join?t.join(", "):t;f.$setValidity("serverError",n)};f.setModalValue=function(n){o&&console.log("inactiveSaveDirective; setModalValue, ModalValue: "+n);t.model=n;t.$apply()};t.setFocus==="true"&&n(function(){i.focus()},0)}}}angular.module("app").directive("inactiveSave",n);n.$inject=["$timeout"]}();angular.module("logToServer",[]).service("$log",function(){this.log=function(n){JL("Angular").trace(n)};this.debug=function(n){JL("Angular").debug(n)};this.info=function(n){JL("Angular").info(n)};this.warn=function(n){JL("Angular").warn(n)};this.error=function(n){JL("Angular").error(n)}}).factory("$exceptionHandler",function(){return function(n,t){JL("Angular").fatalException(t,n);throw n;}}).factory("logToServerInterceptor",["$q",function(n){return{request:function(n){return n.msBeforeAjaxCall=(new Date).getTime(),n},response:function(n){if(n.config.warningAfter){var i=(new Date).getTime(),t=i-n.config.msBeforeAjaxCall;t>n.config.warningAfter&&JL("Angular.Ajax").warn({timeTakenInMs:t,config:n.config,data:n.data})}return n},responseError:function(t){return n.reject(t)}}}]),function(){"use strict";function n(n,t,i){return{template:'<div><div ng-click="onClick($event)" class="form-control" style="height: 128px; width: 168px"><div ng-if="!model" class="placeholder" translate-once="GENERAL.LOGO.YOUR_LOGO"><\/div><img id="imgLogo" translate-once-title="GENERAL.LOGO.YOUR_LOGO" ng-src="{{model}}" ng-if="model" /><\/div><label tabindex="-1" style="visibility: hidden; position: absolute; overflow: hidden; width: 0px; height: 0px; border: none; margin: 0px; padding: 0px;">upload<input type="file" accept="image/*" ><\/label><\/div>',restrict:"E",transclude:!0,replace:!0,scope:{model:"=ngModel"},link:function(r,u){var f,e,o,s;r.onClick=function(n){n.stopPropagation();n.preventDefault();var t=u[0].childNodes[1].childNodes[1];t.click()};e=function(){f.getLogo(function(n){n&&(r.model=n)})};o=function(t){var u,o,e;if((typeof FileReader=="undefined"&&i("GENERAL.LOGO.NOT_SUPPORTED").then(function(t){n.error(t)}),u=t.target.files[0],u)&&u.type.match("image.*")){if(o=u.size,o>5e5){i("GENERAL.LOGO.SIZE_ERROR").then(function(t){n.error(t)});return}e=new FileReader;e.onload=function(n){f.saveLogo(n.target.result,function(n){n&&(r.model=n)})};e.readAsDataURL(u)}};u.bind("change",o);s=function(){f=t.currentLogo.getService();e()};s()}}}angular.module("app").directive("logoFile",n);n.$inject=["notificationFactory","genericDataFactory","$translate"]}(),function(){"use strict";function n(){return{template:'<div class="modal fade"><div class="modal-dialog {{ mSizes ? mSizes : \'\' }}"><div class="modal-content"><div class="modal-header"> {{ mTitle }}<button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;<\/button><\/div><div class="modal-body" ng-transclude><\/div><\/div><\/div><\/div>',restrict:"E",transclude:!0,replace:!0,scope:{mVisible:"=",mTitle:"@",mSizes:"@"},link:function(n,t){n.$watch("mVisible",function(){n.mVisible==!0?$(t).modal("show"):$(t).modal("hide")});$(t).on("hidden.bs.modal",function(){n.$apply(function(){n.mVisible=!1})})}}}angular.module("app").directive("modal",n)}(),function(){"use strict";function n(){return{success:function(n){toastr.options={showDuration:"100",hideDuration:"0",timeOut:"2000",extendedTimeOut:"3000",positionClass:"toast-top-center"};toastr.clear();toastr.options={showDuration:"100",hideDuration:"100",timeOut:"2000",extendedTimeOut:"3000",positionClass:"toast-top-center"};n===undefined&&(n="Success.");toastr.success(n)},error:function(n){var t,i,r;if(n){if(n.isHandled===!0)return;if(i=!0,n.length&&n.length>0)t=n,i=!1;else if(n&&n.data&&angular.isObject(n.data))for(r in n.data){t=n.data[r];break}i&&n.status&&(t||(t="Http status "+n.status+". "+n.statusText))}toastr.options={showDuration:"100",hideDuration:"100",timeOut:"6000",extendedTimeOut:"8000",positionClass:"toast-top-center"};t===undefined&&(t="Unknown error occurred.");toastr.error(t)},warning:function(n){toastr.options={showDuration:"100",hideDuration:"100",timeOut:"6000",extendedTimeOut:"8000",positionClass:"toast-top-center"};n===undefined&&(n="Unknown warning occurred.");toastr.warning(n)}}}angular.module("app").factory("notificationFactory",n)}(),function(){"use strict";function n(n){this.getService=function(i){if(i==="")throw"Invalid end point";return n(i+"/:id",{id:"@id"},{get:{method:"GET",interceptor:{responseError:t},timeout:1e4,warningAfter:8e3},save:{method:"POST",interceptor:{responseError:t},timeout:8e3,warningAfter:5e3},query:{method:"GET",interceptor:{responseError:t},timeout:8e3,warningAfter:5e3,isArray:!0},update:{method:"PUT",interceptor:{responseError:t},timeout:8e3,warningAfter:5e3},patch:{method:"PATCH",interceptor:{responseError:t},timeout:8e3,warningAfter:5e3},remove:{method:"PUT",interceptor:{responseError:t},timeout:8e3,warningAfter:5e3},"delete":{method:"DELETE",interceptor:{responseError:t},timeout:8e3,warningAfter:5e3}})};var t=function(n){if(!n.isHandled){var t="timeout";n&&n.status&&n.data&&(t=n.data.ExceptionMessage);JL("Angular.Ajax").fatalException({errorMessage:t,status:n.status,config:n.config},n.data)}}}angular.module("app").service("restService",n);n.$inject=["$resource"]}(),function(){"use strict";function n(n,t){return{restrict:"A",require:["ngModel"],compile:function(i){if(i[0].nodeName!=="INPUT")throw"Error. currencyFormat directive must be used inside an <input> element.";return function(i,r,u,f){var e=f[0],o=!1,b=u,s=u.hasOwnProperty("max")&&u.max!==""?parseInt(u.max):9999999,h=u.hasOwnProperty("min")&&u.min!==""?parseInt(u.min):0,c=u.hasOwnProperty("step")&&u.step!==""?parseInt(u.step):1,l=u.hasOwnProperty("fractionSize")&&!isNaN(u.fractionSize)?parseInt(u.fractionSize):!1,a=u.hasOwnProperty("hideZero")&&(u.hideZero==="true"||u.hideZero==="True")?!0:!1;r.on("keydown",function(n){var i,t;if(n.keyCode===38||n.keyCode===40){if(n.preventDefault(),i=n.shiftKey?c*10:c,n.keyCode===40&&(i*=-1),t=e.$modelValue==null||isNaN(e.$modelValue)?i:Number(e.$modelValue)+i,s!==!1&&t>s?t=s:h!==!1&&t<h&&(t=h),o&&console.log("keydown newValue: "+t),e.$setDirty(),!e.setModalValue)throw"Error. Missing the method setModalValue. Probably either activeSave or inactiveSave directive is required.";e.setModalValue(t)}});r.bind("blur",function(){o&&console.log("event blur");e.$valid&&w()});e.$formatters.push(function(n){return o&&console.log("formatters.push modelValue: "+n),a&&n==0?"":l==!1?t("currency")(n):t("currency")(n,l)});e.$parsers.push(function(n){return o&&console.log("parsers.push viewValue: "+n),v(n)});e.$validators.currency=function(n,t){return(o&&console.log("validators.currency modelValue: "+n+", viewValue: "+t),t===undefined||t===null||t==="")?!0:y(t)?!0:!1};e.$validators.min=function(n,t){return(o&&console.log("validators.min modelValue: "+n+", viewValue: "+t),h!==!1&&n<h)?!1:!0};e.$validators.max=function(n,t){return(o&&console.log("validators.max modelValue: "+n+", viewValue: "+t),s!==!1&&n>s)?!1:!0};var v=function(t){return t&&!angular.isString(t)&&(t=new String(t)),t&&(t=t.replace(n.NUMBER_FORMATS.CURRENCY_SYM,""),t=t.replace(/\s/g,""),n.NUMBER_FORMATS.DECIMAL_SEP===","&&(t=t.replace(/\./g,""),t=t.replace(/,/g,".")),n.NUMBER_FORMATS.GROUP_SEP===","&&(t=t.replace(/,/g,""))),t},y=function(t){return t&&(t=t.replace(n.NUMBER_FORMATS.GROUP_SEP,""),p().test(t))?!0:!1},p=function(){var i="\\s*(\\d*|(\\d*(\\"+n.NUMBER_FORMATS.DECIMAL_SEP+"\\d*)))\\s*",t=n.NUMBER_FORMATS.CURRENCY_SYM;return t=="$"&&(t="\\$"),n.NUMBER_FORMATS.PATTERNS[1].posPre?new RegExp("^\\s*("+t+")?"+i+"$"):new RegExp("^"+i+"("+t+")?\\s*$")},w=function(){for(var t=e.$formatters,i=t.length,n=e.$$rawModelValue;i--;)n=t[i](n);e.$setViewValue(n);e.$render()}}}}}angular.module("app").directive("currencyFormat",n);n.$inject=["$locale","$filter"]}(),function(){"use strict";function n(n,t){return{restrict:"A",require:["ngModel"],compile:function(i){if(i[0].nodeName!=="INPUT")throw"Error. numberFormat directive must be used inside an <input> element.";return function(i,r,u,f){var e=f[0],o=!1,h=u.hasOwnProperty("max")&&u.max!==""?new Date(u.max):!1,c=u.hasOwnProperty("min")&&u.min!==""?new Date(u.min):!1,v=u.hasOwnProperty("step")&&u.step!==""?parseInt(u.step):1,s=u.hasOwnProperty("format")&&u.format!==""?u.format:!1,l,a;r.on("keydown",function(n){var i,t;if(n.keyCode===38||n.keyCode===40){if(n.preventDefault(),i=v,n.keyCode===40&&(i*=-1),t=e.$modelValue!=null&&angular.isDate(e.$modelValue)?n.shiftKey||s=="month"?new Date(e.$modelValue).addMonths(i):new Date(e.$modelValue).addDays(i):new Date,h!==!1&&t>h?t=h:c!==!1&&t<c&&(t=c),o&&console.log("keydown newValue: "+t),e.$setDirty(),!e.setModalValue)throw"Error. Missing the method setModalValue. Probably either activeSave or inactiveSave directive is required.";e.setModalValue(t)}});r.bind("blur",function(){o&&console.log("event blur");e.$valid&&a()});e.$formatters.push(function(t){return o&&console.log("formatters.push modelValue: "+t),n("date")(t,l())});e.$parsers.push(function(n){o&&console.log("parsers.push viewValue: "+n);n&&s=="month"&&(n="01 "+n);var i=t(n,l(s=="month"));return i!==undefined?i:null});e.$validators.date=function(n,i){if(o&&console.log("validators.date modelValue: "+n+", viewValue: "+i),i===undefined||i===null||i==="")return!0;i&&s=="month"&&(i="01 "+i);var r=t(i,l(s=="month"));return r!==undefined?!0:!1};e.$validators.min=function(n,t){return(o&&console.log("validators.min modelValue: "+n+", viewValue: "+t),c!==!1&&n<c)?!1:!0};e.$validators.max=function(n,t){return(o&&console.log("validators.max modelValue: "+n+", viewValue: "+t),h!==!1&&n>h)?!1:!0};e.setFormat=function(n){s=n=="month"?"month":!1;e.$valid&&a()};e.setModalDateAndDirty=function(n){o&&console.log("setModalDate, ModalValue: "+n);i.model=n;e.$setDirty()};e.setModalDateFromAndDirty=function(n,t){o&&console.log("setModalDateTo, ModalValue: "+n);i.model.from=n;t||e.$setDirty()};e.setModalDateToAndDirty=function(n,t){o&&console.log("setModalDateFrom, ModalValue: "+n);i.model.to=n;t||e.$setDirty()};l=function(n){return s===!1?"mediumDate":s=="month"?n?"dd MMM y":"MMM y":s};a=function(){for(var t=e.$formatters,i=t.length,n=e.$$rawModelValue;i--;)n=t[i](n);e.$setViewValue(n);e.$render()}}}}}angular.module("app").directive("dateFormat",n);n.$inject=["$filter","$dateParser"]}(),function(){"use strict";function n(n,t){return{restrict:"A",require:["ngModel"],compile:function(i){if(i[0].nodeName!=="INPUT")throw"Error. numberFormat directive must be used inside an <input> element.";return function(i,r,u,f){var e=f[0],o=!1,k=u,s=u.hasOwnProperty("max")&&u.max!==""?parseInt(u.max):!1,h=u.hasOwnProperty("min")&&u.min!==""?parseInt(u.min):!1,c=u.hasOwnProperty("step")&&u.step!==""?parseInt(u.step):1,l=u.hasOwnProperty("fractionSize")&&!isNaN(u.fractionSize)?parseInt(u.fractionSize):!1,a=u.hasOwnProperty("hideZero")&&(u.hideZero==="true"||u.hideZero==="True")?!0:!1,v=u.hasOwnProperty("wholeNumber")&&(u.wholeNumber==="true"||u.wholeNumber==="True")?!0:!1;r.on("keydown",function(n){var i,t;if(n.keyCode===38||n.keyCode===40){if(n.preventDefault(),i=n.shiftKey?c*10:c,n.keyCode===40&&(i*=-1),t=e.$modelValue==null||isNaN(e.$modelValue)?i:Number(e.$modelValue)+i,s!==!1&&t>s?t=s:h!==!1&&t<h&&(t=h),o&&console.log("keydown newValue: "+t),e.$setDirty(),!e.setModalValue)throw"Error. Missing the method setModalValue. Probably either activeSave or inactiveSave directive is required.";e.setModalValue(t)}});r.bind("blur",function(){o&&console.log("event blur");e.$valid&&b()});e.$formatters.push(function(n){return o&&console.log("formatters.push modelValue: "+n),a&&n==0?"":l==!1?t("number")(n):t("number")(n,l)});e.$parsers.push(function(n){return o&&console.log("parsers.push viewValue: "+n),y(n)});e.$validators.number=function(n,t){return(o&&console.log("validators.number modelValue: "+n+", viewValue: "+t),t===undefined||t===null||t==="")?!0:p(t)?!0:!1};e.$validators.min=function(n,t){return(o&&console.log("validators.min modelValue: "+n+", viewValue: "+t),h!==!1&&n<h)?!1:!0};e.$validators.max=function(n,t){return(o&&console.log("validators.max modelValue: "+n+", viewValue: "+t),s!==!1&&n>s)?!1:!0};e.$validators.wholeNumber=function(n,t){return(o&&console.log("validators.wholeNumberr modelValue: "+n+", viewValue: "+t),v!==!1)?n%1==0?new RegExp(/\./g).test(n)?!1:!0:!1:!0};var y=function(t){return t&&!angular.isString(t)&&(t=new String(t)),t&&(n.NUMBER_FORMATS.DECIMAL_SEP===","&&(t=t.replace(/\./g,""),t=t.replace(/,/g,".")),n.NUMBER_FORMATS.GROUP_SEP===","&&(t=t.replace(/,/g,""))),t},p=function(t){return(t&&(t=t.replace(n.NUMBER_FORMATS.GROUP_SEP,"")),w().test(t))?!0:!1},w=function(){return n.NUMBER_FORMATS.DECIMAL_SEP==="."?/^\s*(\-|\+)?(\d+|(\d*(\.\d*)))\s*$/:/^\s*(\-|\+)?(\d+|(\d*(\,\d*)))\s*$/},b=function(){for(var t=e.$formatters,i=t.length,n=e.$$rawModelValue;i--;)n=t[i](n);e.$setViewValue(n);e.$render()}}}}}angular.module("app").directive("numberFormat",n);n.$inject=["$locale","$filter"]}(),function(){"use strict";function n(n,t){return{restrict:"A",require:["ngModel"],compile:function(i){if(i[0].nodeName!=="INPUT")throw"Error. percentageFormat directive must be used inside an <input> element.";return function(i,r,u,f){var e=f[0],o=!1,b=u,s=u.hasOwnProperty("max")&&u.max!==""?parseInt(u.max):!1,h=u.hasOwnProperty("min")&&u.min!==""?parseInt(u.min):!1,c=u.hasOwnProperty("step")&&u.step!==""?parseInt(u.step):1,l=u.hasOwnProperty("fractionSize")&&!isNaN(u.fractionSize)?parseInt(u.fractionSize):!1,a=u.hasOwnProperty("hideZero")&&(u.hideZero==="true"||u.hideZero==="True")?!0:!1;r.on("keydown",function(n){var i,t;if(n.keyCode===38||n.keyCode===40){if(n.preventDefault(),i=n.shiftKey?c*10:c,n.keyCode===40&&(i*=-1),t=e.$modelValue==null||isNaN(e.$modelValue)?i:Number(e.$modelValue)+i,s!==!1&&t>s?t=s:h!==!1&&t<h&&(t=h),o&&console.log("keydown newValue: "+t),e.$setDirty(),!e.setModalValue)throw"Error. Missing the method setModalValue. Probably either activeSave or inactiveSave directive is required.";e.setModalValue(t)}});r.bind("blur",function(){o&&console.log("event blur");e.$valid&&w()});e.$formatters.push(function(n){return o&&console.log("formatters.push modelValue: "+n),a&&n==0?"":l==!1?t("number")(n)+"%":t("number")(n,l)+"%"});e.$parsers.push(function(n){return o&&console.log("parsers.push viewValue: "+n),v(n)});e.$validators.percentage=function(n,t){return(o&&console.log("validators.percentage modelValue: "+n+", viewValue: "+t),t===undefined||t===null||t==="")?!0:y(t)?!0:!1};e.$validators.min=function(n,t){return(o&&console.log("validators.min modelValue: "+n+", viewValue: "+t),h!==!1&&n<h)?!1:!0};e.$validators.max=function(n,t){return(o&&console.log("validators.max modelValue: "+n+", viewValue: "+t),s!==!1&&n>s)?!1:!0};var v=function(t){return t&&!angular.isString(t)&&(t=new String(t)),t&&(t=t.replace(/\s/g,""),t=t.replace(/%/g,""),n.NUMBER_FORMATS.DECIMAL_SEP===","&&(t=t.replace(/\./g,""),t=t.replace(/,/g,".")),n.NUMBER_FORMATS.GROUP_SEP===","&&(t=t.replace(/,/g,""))),t},y=function(n){return p().test(n)?!0:!1},p=function(){return n.NUMBER_FORMATS.DECIMAL_SEP==="."?/^\s*(\-|\+)?(\d+|(\d*(\.\d*)))\s*%?\s*$/:/^\s*(\-|\+)?(\d+|(\d*(\,\d*)))\s*%?\s*$/},w=function(){for(var t=e.$formatters,i=t.length,n=e.$$rawModelValue;i--;)n=t[i](n);e.$setViewValue(n);e.$render()}}}}}angular.module("app").directive("percentageFormat",n);n.$inject=["$locale","$filter"]}(),function(){"use strict";function n(n,t){return{restrict:"A",require:["ngModel"],compile:function(i){if(i[0].nodeName!=="INPUT")throw"Error. timeFormat directive must be used inside an <input> element.";return function(i,r,u,f){var e=f[0],o=!1,w=u,s=u.hasOwnProperty("max")&&u.max!==""?parseInt(u.max):!1,h=u.hasOwnProperty("min")&&u.min!==""?parseInt(u.min):0,c=u.hasOwnProperty("step")&&u.step!==""?parseInt(u.step):1,l=u.hasOwnProperty("hideZero")&&(u.hideZero==="true"||u.hideZero==="True")?!0:!1;r.on("keydown",function(n){var i,t;if(n.keyCode===38||n.keyCode===40){if(n.preventDefault(),i=n.shiftKey?c*60:c,n.keyCode===40&&(i*=-1),t=e.$modelValue==null||isNaN(e.$modelValue)?i:Number(e.$modelValue)+i,s!==!1&&t>s?t=s:h!==!1&&t<h&&(t=h),o&&console.log("keydown newValue: "+t),e.$setDirty(),!e.setModalValue)throw"Error. Missing the method setModalValue. Probably either activeSave or inactiveSave directive is required.";e.setModalValue(t)}});r.bind("blur",function(){o&&console.log("event blur");e.$valid&&p()});e.$formatters.push(function(n){return o&&console.log("formatters.push modelValue: "+n),l&&n==0?"":t("time")(n)});e.$parsers.push(function(n){return o&&console.log("parsers.push viewValue: "+n),a(n)});e.$validators.time=function(n,t){return(o&&console.log("validators.time modelValue: "+n+", viewValue: "+t),t===undefined||t===null||t==="")?!0:v(t)?!0:!1};e.$validators.min=function(n,t){return(o&&console.log("validators.min modelValue: "+n+", viewValue: "+t),h!==!1&&n<h)?!1:!0};e.$validators.max=function(n,t){return(o&&console.log("validators.max modelValue: "+n+", viewValue: "+t),s!==!1&&n>s)?!1:!0};var a=function(t){var i;return t&&!angular.isString(t)&&(t=new String(t)),t&&(t.indexOf(":")>-1?(i=t.split(":"),i[1].length==1&&(i[1]=i[1]+"0"),i[1].length>2&&(i[1]=i[1]/Math.pow(10,i[1].length-2)),t=Number(i[0])*60+Number(i[1])):t.indexOf(n.NUMBER_FORMATS.DECIMAL_SEP)>-1?(i=t.split(n.NUMBER_FORMATS.DECIMAL_SEP),i[1].length==1&&(i[1]=i[1]+"0"),t=Number(i[0])*60+Number(i[1])*60/100):t=Number(t)*60),Math.round(t)},v=function(n){return y().test(n)?!0:!1},y=function(){return new RegExp("^\\s*((\\d+|(\\d*(\\:\\d*)))|(\\d+|(\\d*(\\"+n.NUMBER_FORMATS.DECIMAL_SEP+"\\d*))))\\s*")},p=function(){for(var t=e.$formatters,i=t.length,n=e.$$rawModelValue;i--;)n=t[i](n);e.$setViewValue(n);e.$render()}}}}}angular.module("app").directive("timeFormat",n);n.$inject=["$locale","$filter"]}(),function(){"use strict";function n(){return function(n){if(angular.isDefined(n)&&(n&&!angular.isNumber(n)&&(n=Number(n)),n)){var t=n%60,i=(n-t)/60;n=new String(i)+":"+("0"+t).slice(-2)}return n}}angular.module("app").filter("time",n)}(),function(){"use strict";function n(n,t,i){var r=this,u,f;r.showDialog=!1;r.size="";r.showUrlDialog=function(n){r.size="modal-lg";r.url=n;r.showDialog=!0};r.showSupport=function(){r.size="";r.url="./applib/layout/supportPage.html";r.showDialog=!0};r.sendSupportMessage=function(){r.supportForm.message.$setDirty();r.supportForm.$valid&&u.save({message:r.supportMessage},function(){i("SUPPORT.CONFIRMATION_TEXT").then(function(t){n.success(t)});r.showDialog=!1},function(t){var i,u;if(t&&t.data&&angular.isObject(t.data)){i=!1;for(u in t.data)u.toLowerCase().indexOf("message")!=-1&&(i=!0,r.supportForm.message.setServerErrorValidity(!1,t.data[u]));if(i){t.isHandled=!0;return}}n.error(t)})};r.close=function(){r.showDialog=!1};f=function(){u=t.getService("./api/support")};f()}angular.module("app").controller("footerController",n);n.$inject=["notificationFactory","restService","$translate"]}(),function(){"use strict";function n(n,t){var i=this,r;i.getClass=function(n){return n==="/"?t.path()==="/"?"active":"":t.path().substr(0,n.length)===n?"active":""};i.isCollapsed=!0;n.$on("$routeChangeSuccess",function(){i.isCollapsed=!0});r=function(){};r()}angular.module("app").controller("navController",n);n.$inject=["$scope","$location"]}(),function(){"use strict";Date.prototype.toDateOnly=function(){return new Date(this.toDateString())};Date.prototype.toDateOnlyFirstDayInMonth=function(){return new Date(this.getFullYear(),this.getMonth(),1)};Date.prototype.toDateOnlyLastDayInMonth=function(){return new Date(this.getFullYear(),this.getMonth()+1,0)};Date.prototype.addDays=function(n){return this.setTime(this.getTime()+n*864e5),this};Date.prototype.addMonths=function(n){var r=this.getFullYear(),i=this.getMonth(),f=this.getDate(),t=i+n,u;if(t>12)u=t/12,r=r+u,i=i+n-u*12;else if(t<1){do r=r-1,t=t+12;while(t<1);i=t}else i=t;return new Date(r,i,f)};Date.prototype.toServerDateString=function(){var t=this.getMonth()+1;return this.getFullYear()+"-"+n(t)+"-"+n(this.getDate())+"T00:00:00"};var n=function(n){return n<10?"0"+n:n}}();